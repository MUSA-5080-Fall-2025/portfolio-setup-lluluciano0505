<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.24">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Jingqi Lu">
<meta name="dcterms.date" content="2025-11-16">

<title>Spatial Predictive Modeling – Sanitation 311 Requests – Luciano Lu - MUSA 5080 Portfolio</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dc55a5b9e770e841cd82e46aadbfb9b0.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-e31584831b205ffbb2d98406f31c2a5b.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="../../site_libs/kePrint-0.0.1/kePrint.js"></script>

<link href="../../site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">



</head>

<body class="floating nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Luciano Lu - MUSA 5080 Portfolio</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-weekly-notes" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Weekly Notes</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-weekly-notes">    
        <li>
    <a class="dropdown-item" href="../../weekly-notes/week-01-notes.html">
 <span class="dropdown-text">Week 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../weekly-notes/week-02-notes.html">
 <span class="dropdown-text">Week 2</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-labs" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Labs</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-labs">    
        <li>
    <a class="dropdown-item" href="../../Labs/lab_0/lab0_template.html">
 <span class="dropdown-text">Lab 0</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-assignments" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Assignments</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-assignments">    
        <li>
    <a class="dropdown-item" href="../../assignments/assignment_1/assignment1_template.html">
 <span class="dropdown-text">Assignment 1: Census Data Exploration</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../assignments/assignment_2/Luciano_Lu_assignment2.html">
 <span class="dropdown-text">Assignment 2: Data Visualization with ggplots</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../assignments/midterm/appendix_nolog.html">
 <span class="dropdown-text">Midterm Project</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../assignments/midterm/Presentation_slides.html">
 <span class="dropdown-text">Midterm PPT</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../assignments/assignment_4/Luciano_Lu_assignment4.html">
 <span class="dropdown-text">Assignment4</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#step-1-choose-sanitation-complaints-as-predict-data" id="toc-step-1-choose-sanitation-complaints-as-predict-data" class="nav-link active" data-scroll-target="#step-1-choose-sanitation-complaints-as-predict-data">Step 1: Choose sanitation complaints as predict data</a>
  <ul class="collapse">
  <li><a href="#getting-the-data" id="toc-getting-the-data" class="nav-link" data-scroll-target="#getting-the-data">Getting the Data</a></li>
  </ul></li>
  <li><a href="#step-2-exploratory-spatial-analysis" id="toc-step-2-exploratory-spatial-analysis" class="nav-link" data-scroll-target="#step-2-exploratory-spatial-analysis">Step 2: Exploratory Spatial Analysis</a></li>
  <li><a href="#step-3-analysis" id="toc-step-3-analysis" class="nav-link" data-scroll-target="#step-3-analysis">Step 3: Analysis</a>
  <ul class="collapse">
  <li><a href="#overview" id="toc-overview" class="nav-link" data-scroll-target="#overview">Overview</a></li>
  <li><a href="#spatial-clustering" id="toc-spatial-clustering" class="nav-link" data-scroll-target="#spatial-clustering">1. Spatial Clustering</a></li>
  <li><a href="#count-regression-modeling" id="toc-count-regression-modeling" class="nav-link" data-scroll-target="#count-regression-modeling">2. Count Regression Modeling</a></li>
  <li><a href="#spatial-cross-validation-2017" id="toc-spatial-cross-validation-2017" class="nav-link" data-scroll-target="#spatial-cross-validation-2017">3. Spatial Cross-Validation (2017)</a></li>
  <li><a href="#temporal-validation-2018" id="toc-temporal-validation-2018" class="nav-link" data-scroll-target="#temporal-validation-2018">4. Temporal Validation (2018)</a></li>
  <li><a href="#challenge-task-cross-domain-validation-2018-burglary" id="toc-challenge-task-cross-domain-validation-2018-burglary" class="nav-link" data-scroll-target="#challenge-task-cross-domain-validation-2018-burglary">5. Challenge Task: Cross-Domain Validation (2018 Burglary)</a></li>
  <li><a href="#interpretation" id="toc-interpretation" class="nav-link" data-scroll-target="#interpretation">6. Interpretation</a></li>
  </ul></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Spatial Predictive Modeling – Sanitation 311 Requests</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
<p class="subtitle lead">MUSA 5080 – Fall 2025</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Jingqi Lu </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">November 16, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="step-1-choose-sanitation-complaints-as-predict-data" class="level2">
<h2 class="anchored" data-anchor-id="step-1-choose-sanitation-complaints-as-predict-data">Step 1: Choose sanitation complaints as predict data</h2>
<p>In this step, I subset the raw 311 sanitation requests to 2017 observations with valid geographic coordinates and project them to ESRI:102271, creating a clean point dataset of 19,733 violations for spatial analysis.</p>
<section id="getting-the-data" class="level3">
<h3 class="anchored" data-anchor-id="getting-the-data">Getting the Data</h3>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Save locally under /data/Sanitation.csv</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>sanitation_raw <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/Sanitation.csv"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 1.2 Clean and convert to spatial points (keep necessary columns)</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjust variable names based on actual CSV field names</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>sanitation_sf <span class="ot">&lt;-</span> sanitation_raw <span class="sc">%&gt;%</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">CreationDate =</span> <span class="fu">mdy</span>(<span class="st">`</span><span class="at">Creation Date</span><span class="st">`</span>),</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">Year =</span> <span class="fu">year</span>(CreationDate)) <span class="sc">%&gt;%</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Year <span class="sc">==</span> <span class="dv">2017</span>,</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>         <span class="sc">!</span><span class="fu">is.na</span>(Latitude), <span class="sc">!</span><span class="fu">is.na</span>(Longitude)) <span class="sc">%&gt;%</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"Longitude"</span>, <span class="st">"Latitude"</span>), <span class="at">crs =</span> <span class="dv">4326</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="st">'ESRI:102271'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
</section>
<section id="step-2-exploratory-spatial-analysis" class="level2">
<h2 class="anchored" data-anchor-id="step-2-exploratory-spatial-analysis">Step 2: Exploratory Spatial Analysis</h2>
<p>To analyze spatial variation in complaint intensity, I construct a 500 m × 500 m fishnet grid over Chicago, aggregate sanitation violations to each cell, and map the resulting count distribution.</p>
<section id="part-1-data-loading-exploration" class="level4">
<h4 class="anchored" data-anchor-id="part-1-data-loading-exploration">Part 1: Data Loading &amp; Exploration</h4>
<p>In this part, I load the raw sanitation 311 service request data and the Chicago city boundary, then filter the requests to 2017 incidents with valid latitude–longitude coordinates. Both layers are projected into a common planar CRS (ESRI:102271) so that distances are measured in meters and are suitable for subsequent spatial analysis. The exploratory point map shows that sanitation code violations are far from uniformly distributed: they cluster along central, south, and west corridors of the city, while the North Side exhibits lighter, more scattered activity. This initial pattern already suggests strong spatial concentration of complaints and motivates a grid-based analysis of variation in complaint intensity across the city.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Chicago boundary for context</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>chicagoBoundary <span class="ot">&lt;-</span> <span class="fu">suppressMessages</span>(</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_read</span>(</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"https://raw.githubusercontent.com/urbanSpatial/Public-Policy-Analytics-Landing/master/DATA/Chapter5/chicagoBoundary.geojson"</span>,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">quiet =</span> <span class="cn">TRUE</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="st">"ESRI:102271"</span>)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Quick spatial plot: where are the violations located?</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> chicagoBoundary, <span class="at">fill =</span> <span class="st">"gray95"</span>, <span class="at">color =</span> <span class="st">"gray60"</span>) <span class="sc">+</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> sanitation_sf, <span class="at">color =</span> <span class="st">"#d62828"</span>, <span class="at">size =</span> <span class="fl">0.1</span>, <span class="at">alpha =</span> <span class="fl">0.4</span>) <span class="sc">+</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Spatial Distribution of Sanitation Code Violations in Chicago"</span>,</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="fu">paste0</span>(<span class="st">"2017, n = "</span>, <span class="fu">nrow</span>(sanitation_sf)),</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Source: Chicago 311 Service Requests (Open Data Portal)"</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"gray40"</span>)</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Luciano_Lu_assignment4_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Verify result</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"311 sanitation records for 2017:"</span>, <span class="fu">nrow</span>(sanitation_sf), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>311 sanitation records for 2017: 19733 </code></pre>
</div>
</div>
<p>Violations cluster densely along the city’s central and southern corridors, especially on the South and West Sides. The North Side shows lighter, more scattered activity. Overall, incidents follow residential density and older housing patterns, revealing clear spatial concentration rather than uniform distribution.</p>
</section>
<section id="part-2-fishnet-grid-creation" class="level4">
<h4 class="anchored" data-anchor-id="part-2-fishnet-grid-creation">Part 2: Fishnet Grid Creation</h4>
<p>Here I construct a 500 m × 500 m fishnet grid over Chicago, intersect it with the city boundary, and aggregate sanitation violations to each grid cell. This produces a count surface of sanitation complaints that standardizes the spatial unit of analysis across the entire city.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>fishnet <span class="ot">&lt;-</span> <span class="fu">st_make_grid</span>(</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  chicagoBoundary,</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">cellsize =</span> <span class="dv">500</span>,   <span class="co"># 500 meters per cell</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">square =</span> <span class="cn">TRUE</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_sf</span>() <span class="sc">%&gt;%</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">uniqueID =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">lengths</span>(<span class="fu">st_intersects</span>(., chicagoBoundary)) <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"✓ Created fishnet grid with"</span>, <span class="fu">nrow</span>(fishnet), <span class="st">"cells</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>✓ Created fishnet grid with 2458 cells</code></pre>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>sanitation_count <span class="ot">&lt;-</span> <span class="fu">st_join</span>(sanitation_sf, fishnet, <span class="at">join =</span> st_within) <span class="sc">%&gt;%</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(uniqueID) <span class="sc">%&gt;%</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">countSanitation =</span> <span class="fu">n</span>())</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>fishnet <span class="ot">&lt;-</span> fishnet <span class="sc">%&gt;%</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(sanitation_count, <span class="at">by =</span> <span class="st">"uniqueID"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">countSanitation =</span> <span class="fu">replace_na</span>(countSanitation, <span class="dv">0</span>))</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fishnet<span class="sc">$</span>countSanitation)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
   0.00    1.00    5.00    8.02   12.00  189.00 </code></pre>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> fishnet, <span class="fu">aes</span>(<span class="at">fill =</span> countSanitation), <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> chicagoBoundary, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">linewidth =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Violations"</span>,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">option =</span> <span class="st">"plasma"</span>,</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">trans =</span> <span class="st">"sqrt"</span>,</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">40</span>)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Sanitation Code Violations by 500m Grid Cell"</span>,</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Chicago, 2017"</span>,</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Source: Chicago 311 Service Requests (Open Data Portal)"</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"gray40"</span>),</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid =</span> <span class="fu">element_blank</span>()</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Luciano_Lu_assignment4_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="part-3-spatial-features" class="level4">
<h4 class="anchored" data-anchor-id="part-3-spatial-features">Part 3: Spatial Features</h4>
<p>To capture local spatial context, I derive two key features for each grid cell: the mean distance to the three nearest sanitation events (nn_meanDist) and the distance to the nearest High–High hotspot centroid (dist_to_hotspot). Smaller values of these features indicate tighter clustering of complaints around the cell or closer proximity to a major hotspot.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>fishnet_centroids <span class="ot">&lt;-</span> <span class="fu">st_centroid</span>(fishnet)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>san_coords <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(sanitation_sf)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>fish_coords <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(fishnet_centroids)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>nn_result <span class="ot">&lt;-</span> <span class="fu">get.knnx</span>(san_coords, fish_coords, <span class="at">k =</span> <span class="dv">3</span>)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>fishnet<span class="sc">$</span>nn_meanDist <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(nn_result<span class="sc">$</span>nn.dist)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fishnet<span class="sc">$</span>nn_meanDist)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>    Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
   1.031  108.565  181.606  294.820  332.417 2213.320 </code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"✓ Added 3-NN mean distance feature</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>✓ Added 3-NN mean distance feature</code></pre>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>coords <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(fishnet_centroids)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>nb <span class="ot">&lt;-</span> <span class="fu">knn2nb</span>(<span class="fu">knearneigh</span>(coords, <span class="at">k =</span> <span class="dv">5</span>))</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>lw <span class="ot">&lt;-</span> <span class="fu">nb2listw</span>(nb, <span class="at">style =</span> <span class="st">"W"</span>, <span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>localM <span class="ot">&lt;-</span> <span class="fu">localmoran</span>(fishnet<span class="sc">$</span>countSanitation, lw)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>mean_val <span class="ot">&lt;-</span> <span class="fu">mean</span>(fishnet<span class="sc">$</span>countSanitation, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>fishnet <span class="ot">&lt;-</span> fishnet <span class="sc">%&gt;%</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">localI =</span> localM[, <span class="dv">1</span>],</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">p_value =</span> localM[, <span class="dv">5</span>],</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">significant =</span> p_value <span class="sc">&lt;</span> <span class="fl">0.05</span>,</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">clusterType =</span> <span class="fu">case_when</span>(</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!</span>significant <span class="sc">~</span> <span class="st">"Not Significant"</span>,</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>      localI <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> countSanitation <span class="sc">&gt;</span> mean_val <span class="sc">~</span> <span class="st">"High-High"</span>,</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>      localI <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> countSanitation <span class="sc">&lt;=</span> mean_val <span class="sc">~</span> <span class="st">"Low-Low"</span>,</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>      localI <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> countSanitation <span class="sc">&gt;</span> mean_val <span class="sc">~</span> <span class="st">"High-Low"</span>,</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>      localI <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> countSanitation <span class="sc">&lt;=</span> mean_val <span class="sc">~</span> <span class="st">"Low-High"</span>,</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Not Significant"</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> fishnet, <span class="fu">aes</span>(<span class="at">fill =</span> clusterType), <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>      <span class="st">"High-High"</span> <span class="ot">=</span> <span class="st">"#d7191c"</span>,</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>      <span class="st">"High-Low"</span>  <span class="ot">=</span> <span class="st">"#fdae61"</span>,</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Low-High"</span>  <span class="ot">=</span> <span class="st">"#abd9e9"</span>,</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Low-Low"</span>   <span class="ot">=</span> <span class="st">"#2c7bb6"</span>,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Not Significant"</span> <span class="ot">=</span> <span class="st">"gray90"</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Cluster Type"</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Local Moran’s I: Sanitation Violation Clusters"</span>,</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"High-High = Hot Spots  |  Low-Low = Cold Spots"</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"gray40"</span>)</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Luciano_Lu_assignment4_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Hot spots (High-High clusters) of sanitation violations concentrate mainly in the central-west and south-side neighborhoods, with small pockets on the far north and southwest. Cold or low-activity areas dominate the rest of the city. The pattern suggests that sanitation issues are spatially clustered rather than random, aligning with older, denser residential zones and areas of higher population turnover.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>hotspots <span class="ot">&lt;-</span> fishnet <span class="sc">%&gt;%</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(clusterType <span class="sc">==</span> <span class="st">"High-High"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_centroid</span>()</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>fishnet<span class="sc">$</span>dist_to_hotspot <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_distance</span>(fishnet_centroids, hotspots <span class="sc">%&gt;%</span> <span class="fu">st_union</span>())</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fishnet<span class="sc">$</span>dist_to_hotspot)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
      0    1000    2000    2479    3606   10000 </code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Calculated distance to nearest High-High cluster</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Calculated distance to nearest High-High cluster</code></pre>
</div>
</div>
</section>
<section id="part-4-count-regression-models" class="level4">
<h4 class="anchored" data-anchor-id="part-4-count-regression-models">Part 4: Count Regression Models</h4>
<p>In this part, I fit Poisson and Negative Binomial count regression models to explain variation in sanitation complaint counts per grid cell using the two spatial features.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>fishnet_model <span class="ot">&lt;-</span> fishnet <span class="sc">%&gt;%</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(uniqueID, countSanitation, nn_meanDist, dist_to_hotspot) <span class="sc">%&gt;%</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">drop_na</span>()</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"✓ Modeling dataset ready with"</span>, <span class="fu">nrow</span>(fishnet_model), <span class="st">"observations</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>✓ Modeling dataset ready with 2458 observations</code></pre>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>model_pois <span class="ot">&lt;-</span> <span class="fu">glm</span>(</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  countSanitation <span class="sc">~</span> nn_meanDist <span class="sc">+</span> dist_to_hotspot,</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> fishnet_model,</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="st">"poisson"</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_pois)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = countSanitation ~ nn_meanDist + dist_to_hotspot, 
    family = "poisson", data = fishnet_model)

Coefficients:
                    Estimate   Std. Error z value            Pr(&gt;|z|)    
(Intercept)      3.726835637  0.014118246  263.97 &lt;0.0000000000000002 ***
nn_meanDist     -0.008449551  0.000112615  -75.03 &lt;0.0000000000000002 ***
dist_to_hotspot -0.000183691  0.000005795  -31.70 &lt;0.0000000000000002 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 25930.1  on 2457  degrees of freedom
Residual deviance:  7285.2  on 2455  degrees of freedom
AIC: 14422

Number of Fisher Scoring iterations: 5</code></pre>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>dispersion <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">residuals</span>(model_pois, <span class="at">type =</span> <span class="st">"pearson"</span>)<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>              model_pois<span class="sc">$</span>df.residual</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Dispersion parameter:"</span>, <span class="fu">round</span>(dispersion, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Dispersion parameter: 4.54 </code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (dispersion <span class="sc">&gt;</span> <span class="fl">1.5</span>) {</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"⚠ Overdispersion detected — Negative Binomial model recommended.</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"✓ Dispersion acceptable for Poisson model.</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>⚠ Overdispersion detected — Negative Binomial model recommended.</code></pre>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>model_nb <span class="ot">&lt;-</span> <span class="fu">glm.nb</span>(</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  countSanitation <span class="sc">~</span> nn_meanDist <span class="sc">+</span> dist_to_hotspot,</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> fishnet_model</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_nb)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm.nb(formula = countSanitation ~ nn_meanDist + dist_to_hotspot, 
    data = fishnet_model, init.theta = 4.336138091, link = log)

Coefficients:
                    Estimate   Std. Error z value            Pr(&gt;|z|)    
(Intercept)      3.835903696  0.028620797  134.03 &lt;0.0000000000000002 ***
nn_meanDist     -0.009733402  0.000182836  -53.24 &lt;0.0000000000000002 ***
dist_to_hotspot -0.000141165  0.000009441  -14.95 &lt;0.0000000000000002 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for Negative Binomial(4.3361) family taken to be 1)

    Null deviance: 10094.5  on 2457  degrees of freedom
Residual deviance:  2054.6  on 2455  degrees of freedom
AIC: 11212

Number of Fisher Scoring iterations: 1

              Theta:  4.336 
          Std. Err.:  0.202 

 2 x log-likelihood:  -11204.329 </code></pre>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Model Fit Comparison:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Model Fit Comparison:</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Poisson AIC:"</span>, <span class="fu">round</span>(<span class="fu">AIC</span>(model_pois), <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Poisson AIC: 14422.11 </code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"NegBin  AIC:"</span>, <span class="fu">round</span>(<span class="fu">AIC</span>(model_nb), <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>NegBin  AIC: 11212.33 </code></pre>
</div>
</div>
<p>The Poisson model showed clear overdispersion (dispersion = 4.54 &gt; 1.5). The Negative Binomial model substantially improved fit (AIC = 11 212 vs 14 422). Both predictors were highly significant and negative: greater distance to nearby violations or to cluster centers corresponds to fewer sanitation code violations. This pattern indicates spatial clustering of violations within central and southern neighborhoods.</p>
</section>
<section id="part-5-spatial-cross-validation-2017" class="level4">
<h4 class="anchored" data-anchor-id="part-5-spatial-cross-validation-2017">Part 5: Spatial Cross-Validation (2017)</h4>
<p>To evaluate spatial generalization, I implement a Leave-One-District-Out (LOGO) cross-validation using Chicago’s 22 police districts as spatial folds.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>policeDistricts <span class="ot">&lt;-</span> <span class="fu">suppressMessages</span>(</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_read</span>(</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"https://data.cityofchicago.org/api/geospatial/24zt-jpfn?method=export&amp;format=GeoJSON"</span>,</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">quiet =</span> <span class="cn">TRUE</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="st">"ESRI:102271"</span>) <span class="sc">|&gt;</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="at">District =</span> dist_num)</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>fishnet <span class="ot">&lt;-</span> <span class="fu">st_join</span>(fishnet, policeDistricts, <span class="at">join =</span> st_within, <span class="at">left =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(District))</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"✓ Joined police districts:"</span>, <span class="fu">length</span>(<span class="fu">unique</span>(fishnet<span class="sc">$</span>District)), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>✓ Joined police districts: 22 </code></pre>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>fishnet_model <span class="ot">&lt;-</span> fishnet <span class="sc">%&gt;%</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(uniqueID, District, countSanitation, nn_meanDist, dist_to_hotspot) <span class="sc">%&gt;%</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">drop_na</span>()</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Data ready for LOGO CV with"</span>, <span class="fu">nrow</span>(fishnet_model), <span class="st">"observations</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Data ready for LOGO CV with 1708 observations</code></pre>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>districts <span class="ot">&lt;-</span> <span class="fu">unique</span>(fishnet_model<span class="sc">$</span>District)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>cv_results <span class="ot">&lt;-</span> <span class="fu">tibble</span>()</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Running LOGO cross-validation across"</span>, <span class="fu">length</span>(districts), <span class="st">"districts...</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Running LOGO cross-validation across 22 districts...</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(districts)) {</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  test_district <span class="ot">&lt;-</span> districts[i]</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  train_data <span class="ot">&lt;-</span> fishnet_model <span class="sc">%&gt;%</span> <span class="fu">filter</span>(District <span class="sc">!=</span> test_district)</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  test_data  <span class="ot">&lt;-</span> fishnet_model <span class="sc">%&gt;%</span> <span class="fu">filter</span>(District <span class="sc">==</span> test_district)</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>  model_cv <span class="ot">&lt;-</span> <span class="fu">glm.nb</span>(countSanitation <span class="sc">~</span> nn_meanDist <span class="sc">+</span> dist_to_hotspot, <span class="at">data =</span> train_data)</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>  test_data <span class="ot">&lt;-</span> test_data <span class="sc">%&gt;%</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">prediction =</span> <span class="fu">predict</span>(model_cv, <span class="at">newdata =</span> test_data, <span class="at">type =</span> <span class="st">"response"</span>))</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>  mae  <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">abs</span>(test_data<span class="sc">$</span>countSanitation <span class="sc">-</span> test_data<span class="sc">$</span>prediction))</span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>  rmse <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((test_data<span class="sc">$</span>countSanitation <span class="sc">-</span> test_data<span class="sc">$</span>prediction)<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>  cv_results <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(cv_results, <span class="fu">tibble</span>(</span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">fold =</span> i,</span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">test_district =</span> test_district,</span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_test =</span> <span class="fu">nrow</span>(test_data),</span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">MAE =</span> mae,</span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">RMSE =</span> rmse</span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"  Fold"</span>, i, <span class="st">"/"</span>, <span class="fu">length</span>(districts), </span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a>      <span class="st">"- District"</span>, test_district, </span>
<span id="cb42-25"><a href="#cb42-25" aria-hidden="true" tabindex="-1"></a>      <span class="st">"- MAE:"</span>, <span class="fu">round</span>(mae, <span class="dv">2</span>), </span>
<span id="cb42-26"><a href="#cb42-26" aria-hidden="true" tabindex="-1"></a>      <span class="st">"- RMSE:"</span>, <span class="fu">round</span>(rmse, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb42-27"><a href="#cb42-27" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  Fold 1 / 22 - District 5 - MAE: 2.65 - RMSE: 4.38 
  Fold 2 / 22 - District 4 - MAE: 2.11 - RMSE: 11.91 
  Fold 3 / 22 - District 22 - MAE: 3.28 - RMSE: 5.82 
  Fold 4 / 22 - District 6 - MAE: 6.08 - RMSE: 8.25 
  Fold 5 / 22 - District 8 - MAE: 3.44 - RMSE: 8.04 
  Fold 6 / 22 - District 7 - MAE: 5.71 - RMSE: 7.96 
  Fold 7 / 22 - District 3 - MAE: 4.51 - RMSE: 6.55 
  Fold 8 / 22 - District 2 - MAE: 4.24 - RMSE: 6.27 
  Fold 9 / 22 - District 9 - MAE: 2.95 - RMSE: 4.79 
  Fold 10 / 22 - District 10 - MAE: 4.35 - RMSE: 6.02 
  Fold 11 / 22 - District 1 - MAE: 2.63 - RMSE: 4.74 
  Fold 12 / 22 - District 12 - MAE: 3.73 - RMSE: 5.1 
  Fold 13 / 22 - District 15 - MAE: 5 - RMSE: 7.3 
  Fold 14 / 22 - District 11 - MAE: 6.35 - RMSE: 8.56 
  Fold 15 / 22 - District 18 - MAE: 6.4 - RMSE: 10.05 
  Fold 16 / 22 - District 25 - MAE: 4.98 - RMSE: 7.07 
  Fold 17 / 22 - District 14 - MAE: 7.81 - RMSE: 10.46 
  Fold 18 / 22 - District 19 - MAE: 7.55 - RMSE: 10.51 
  Fold 19 / 22 - District 16 - MAE: 1.89 - RMSE: 2.87 
  Fold 20 / 22 - District 17 - MAE: 6.35 - RMSE: 16.21 
  Fold 21 / 22 - District 20 - MAE: 4.79 - RMSE: 7.62 
  Fold 22 / 22 - District 24 - MAE: 5.97 - RMSE: 9.85 </code></pre>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">LOGO Cross-Validation complete</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
LOGO Cross-Validation complete</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Mean MAE :"</span>, <span class="fu">round</span>(<span class="fu">mean</span>(cv_results<span class="sc">$</span>MAE), <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Mean MAE : 4.67 </code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Mean RMSE:"</span>, <span class="fu">round</span>(<span class="fu">mean</span>(cv_results<span class="sc">$</span>RMSE), <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Mean RMSE: 7.74 </code></pre>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>cv_results <span class="sc">%&gt;%</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(MAE)) <span class="sc">%&gt;%</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">digits =</span> <span class="dv">2</span>,</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Leave-One-District-Out Cross-Validation Results"</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<table class="table table-striped table-hover caption-top table-sm small">
<caption>Leave-One-District-Out Cross-Validation Results</caption>
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">fold</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">test_district</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">n_test</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">MAE</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">RMSE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">17</td>
<td style="text-align: left;">14</td>
<td style="text-align: right;">46</td>
<td style="text-align: right;">7.81</td>
<td style="text-align: right;">10.46</td>
</tr>
<tr class="even">
<td style="text-align: right;">18</td>
<td style="text-align: left;">19</td>
<td style="text-align: right;">63</td>
<td style="text-align: right;">7.55</td>
<td style="text-align: right;">10.51</td>
</tr>
<tr class="odd">
<td style="text-align: right;">15</td>
<td style="text-align: left;">18</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">6.40</td>
<td style="text-align: right;">10.05</td>
</tr>
<tr class="even">
<td style="text-align: right;">20</td>
<td style="text-align: left;">17</td>
<td style="text-align: right;">82</td>
<td style="text-align: right;">6.35</td>
<td style="text-align: right;">16.21</td>
</tr>
<tr class="odd">
<td style="text-align: right;">14</td>
<td style="text-align: left;">11</td>
<td style="text-align: right;">43</td>
<td style="text-align: right;">6.35</td>
<td style="text-align: right;">8.56</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: left;">6</td>
<td style="text-align: right;">63</td>
<td style="text-align: right;">6.08</td>
<td style="text-align: right;">8.25</td>
</tr>
<tr class="odd">
<td style="text-align: right;">22</td>
<td style="text-align: left;">24</td>
<td style="text-align: right;">41</td>
<td style="text-align: right;">5.97</td>
<td style="text-align: right;">9.85</td>
</tr>
<tr class="even">
<td style="text-align: right;">6</td>
<td style="text-align: left;">7</td>
<td style="text-align: right;">52</td>
<td style="text-align: right;">5.71</td>
<td style="text-align: right;">7.96</td>
</tr>
<tr class="odd">
<td style="text-align: right;">13</td>
<td style="text-align: left;">15</td>
<td style="text-align: right;">32</td>
<td style="text-align: right;">5.00</td>
<td style="text-align: right;">7.30</td>
</tr>
<tr class="even">
<td style="text-align: right;">16</td>
<td style="text-align: left;">25</td>
<td style="text-align: right;">85</td>
<td style="text-align: right;">4.98</td>
<td style="text-align: right;">7.07</td>
</tr>
<tr class="odd">
<td style="text-align: right;">21</td>
<td style="text-align: left;">20</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">4.79</td>
<td style="text-align: right;">7.62</td>
</tr>
<tr class="even">
<td style="text-align: right;">7</td>
<td style="text-align: left;">3</td>
<td style="text-align: right;">43</td>
<td style="text-align: right;">4.51</td>
<td style="text-align: right;">6.55</td>
</tr>
<tr class="odd">
<td style="text-align: right;">10</td>
<td style="text-align: left;">10</td>
<td style="text-align: right;">63</td>
<td style="text-align: right;">4.35</td>
<td style="text-align: right;">6.02</td>
</tr>
<tr class="even">
<td style="text-align: right;">8</td>
<td style="text-align: left;">2</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">4.24</td>
<td style="text-align: right;">6.27</td>
</tr>
<tr class="odd">
<td style="text-align: right;">12</td>
<td style="text-align: left;">12</td>
<td style="text-align: right;">73</td>
<td style="text-align: right;">3.73</td>
<td style="text-align: right;">5.10</td>
</tr>
<tr class="even">
<td style="text-align: right;">5</td>
<td style="text-align: left;">8</td>
<td style="text-align: right;">197</td>
<td style="text-align: right;">3.44</td>
<td style="text-align: right;">8.04</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: left;">22</td>
<td style="text-align: right;">112</td>
<td style="text-align: right;">3.28</td>
<td style="text-align: right;">5.82</td>
</tr>
<tr class="even">
<td style="text-align: right;">9</td>
<td style="text-align: left;">9</td>
<td style="text-align: right;">107</td>
<td style="text-align: right;">2.95</td>
<td style="text-align: right;">4.79</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">5</td>
<td style="text-align: right;">98</td>
<td style="text-align: right;">2.65</td>
<td style="text-align: right;">4.38</td>
</tr>
<tr class="even">
<td style="text-align: right;">11</td>
<td style="text-align: left;">1</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">2.63</td>
<td style="text-align: right;">4.74</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: left;">4</td>
<td style="text-align: right;">235</td>
<td style="text-align: right;">2.11</td>
<td style="text-align: right;">11.91</td>
</tr>
<tr class="even">
<td style="text-align: right;">19</td>
<td style="text-align: left;">16</td>
<td style="text-align: right;">129</td>
<td style="text-align: right;">1.89</td>
<td style="text-align: right;">2.87</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>To evaluate the spatial generalization of the model, a Leave-One-District-Out (LOGO) cross-validation was implemented using Chicago’s 22 police districts as spatial groups. In each fold, one district was held out for testing while the Negative Binomial model was trained on the remaining districts.</p>
<p>Across all 22 folds, the model achieved an average Mean Absolute Error (MAE) of 4.67 and a Root Mean Squared Error (RMSE) of 7.74. These results indicate that the model performs reasonably well in predicting sanitation code violation counts for spatially unseen districts. Errors tend to be larger in central and high-density districts, reflecting the underlying spatial heterogeneity of urban sanitation violations.</p>
<p>Overall, the LOGO cross-validation confirms that the model captures meaningful spatial patterns and maintains moderate predictive accuracy across the city.</p>
</section>
<section id="part-6-model-evaluation" class="level4">
<h4 class="anchored" data-anchor-id="part-6-model-evaluation">Part 6: Model Evaluation</h4>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>fishnet_model<span class="sc">$</span>pred_2017 <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_nb, <span class="at">newdata =</span> fishnet_model, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Generated in-sample predictions for 2017</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Generated in-sample predictions for 2017</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>sanitation_2018 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/Sanitation.csv"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">CreationDate =</span> <span class="fu">mdy</span>(<span class="st">`</span><span class="at">Creation Date</span><span class="st">`</span>),</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">Year =</span> <span class="fu">year</span>(CreationDate)) <span class="sc">%&gt;%</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Year <span class="sc">==</span> <span class="dv">2018</span>,</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>         <span class="sc">!</span><span class="fu">is.na</span>(Latitude), <span class="sc">!</span><span class="fu">is.na</span>(Longitude)) <span class="sc">%&gt;%</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"Longitude"</span>, <span class="st">"Latitude"</span>), <span class="at">crs =</span> <span class="dv">4326</span>) <span class="sc">%&gt;%</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="st">'ESRI:102271'</span>)</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Loaded 2018 sanitation records:"</span>, <span class="fu">nrow</span>(sanitation_2018), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Loaded 2018 sanitation records: 18023 </code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>fishnet_2018 <span class="ot">&lt;-</span> <span class="fu">st_join</span>(fishnet, sanitation_2018, <span class="at">join =</span> st_contains) <span class="sc">%&gt;%</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(uniqueID) <span class="sc">%&gt;%</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count2018 =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">right_join</span>(fishnet_model, <span class="at">by =</span> <span class="st">"uniqueID"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">count2018 =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(count2018), <span class="dv">0</span>, count2018))</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Aggregated 2018 counts to fishnet grid</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Aggregated 2018 counts to fishnet grid</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>fishnet_2018<span class="sc">$</span>pred_2018 <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_nb, <span class="at">newdata =</span> fishnet_2018, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>fishnet_2018 <span class="ot">&lt;-</span> fishnet_2018 <span class="sc">%&gt;%</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">error =</span> count2018 <span class="sc">-</span> pred_2018)</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>mae_2018 <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">abs</span>(fishnet_2018<span class="sc">$</span>error))</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>rmse_2018 <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((fishnet_2018<span class="sc">$</span>error)<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"2018 Temporal Validation complete</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>2018 Temporal Validation complete</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"MAE (2018):"</span>, <span class="fu">round</span>(mae_2018, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>MAE (2018): 5.05 </code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"RMSE (2018):"</span>, <span class="fu">round</span>(rmse_2018, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>RMSE (2018): 7.84 </code></pre>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>points2017 <span class="ot">&lt;-</span> sanitation_sf <span class="sc">%&gt;%</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_coordinates</span>() <span class="sc">%&gt;%</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>kde_2017 <span class="ot">&lt;-</span> spatstat.geom<span class="sc">::</span><span class="fu">ppp</span>(points2017<span class="sc">$</span>X, points2017<span class="sc">$</span>Y,</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>                               <span class="at">window =</span> spatstat.geom<span class="sc">::</span><span class="fu">as.owin</span>(<span class="fu">st_union</span>(chicagoBoundary)))</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>kde_density <span class="ot">&lt;-</span> spatstat.explore<span class="sc">::</span><span class="fu">density.ppp</span>(kde_2017, <span class="at">sigma =</span> <span class="dv">1000</span>) <span class="co"># bandwidth 1km</span></span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>fishnet_2018<span class="sc">$</span>kde_pred <span class="ot">&lt;-</span> raster<span class="sc">::</span><span class="fu">extract</span>(raster<span class="sc">::</span><span class="fu">raster</span>(kde_density), </span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>                                         <span class="fu">st_coordinates</span>(<span class="fu">st_centroid</span>(fishnet)))</span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a>kde_mae  <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">abs</span>(fishnet_2018<span class="sc">$</span>count2018 <span class="sc">-</span> fishnet_2018<span class="sc">$</span>kde_pred), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a>kde_rmse <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((fishnet_2018<span class="sc">$</span>count2018 <span class="sc">-</span> fishnet_2018<span class="sc">$</span>kde_pred)<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"KDE baseline complete</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>KDE baseline complete</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"KDE MAE:"</span>, <span class="fu">round</span>(kde_mae, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>KDE MAE: 8.67 </code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"KDE RMSE:"</span>, <span class="fu">round</span>(kde_rmse, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>KDE RMSE: 12.55 </code></pre>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> chicagoBoundary, <span class="at">fill =</span> <span class="st">"gray95"</span>, <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> fishnet_2018, <span class="fu">aes</span>(<span class="at">fill =</span> error), <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient2</span>(</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">low =</span> <span class="st">"#2c7bb6"</span>,</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">mid =</span> <span class="st">"white"</span>,</span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">high =</span> <span class="st">"#d7191c"</span>,</span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">midpoint =</span> <span class="dv">0</span>,</span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Prediction Error"</span></span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Prediction Errors for 2018 (Observed - Predicted)"</span>,</span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Negative Binomial Model"</span>,</span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Blue = Overprediction, Red = Underprediction"</span></span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb69-16"><a href="#cb69-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb69-17"><a href="#cb69-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb69-18"><a href="#cb69-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb69-19"><a href="#cb69-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"gray40"</span>)</span>
<span id="cb69-20"><a href="#cb69-20" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Luciano_Lu_assignment4_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The Negative Binomial model was trained on 2017 sanitation violations and then applied to predict 2018 counts at the 500 m grid level. Model predictions were compared against observed 2018 violations and against a kernel density estimation (KDE) baseline.</p>
<p>Predictive accuracy (temporal validation): The model achieved MAE = 5.05 and RMSE = 7.84, substantially lower than the KDE baseline (MAE = 8.67, RMSE = 12.55). This indicates the regression model generalizes well across time and captures spatial drivers of violation occurrence that simple hotspot persistence (KDE) cannot.</p>
<p>Spatial pattern of errors (map): The map of 2018 prediction errors shows:</p>
<p>Blue cells (over-prediction): areas where the model predicted more violations than actually occurred—often along the southern and western edges of Chicago.</p>
<p>Red cells (under-prediction): locations where observed violations exceeded predictions, mainly clustered in older central neighborhoods. This spatial structure suggests that some unmodeled factors—such as local inspection policies or demographic changes—still influence violation frequency.</p>
<p>Overall assessment: The Negative Binomial model improves predictive performance over both Poisson and KDE approaches. It handles overdispersion and learns spatial correlates of sanitation activity, making it more robust for forecasting future 311 requests.</p>
</section>
<section id="challenge-task-temporal-validation-2018" class="level4">
<h4 class="anchored" data-anchor-id="challenge-task-temporal-validation-2018">CHALLENGE TASK: Temporal Validation (2018)</h4>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>crime_2018 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://data.cityofchicago.org/resource/3i3m-jwuy.csv"</span>)</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>crime_2018_burg <span class="ot">&lt;-</span> crime_2018 <span class="sc">%&gt;%</span></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(primary_type <span class="sc">==</span> <span class="st">"BURGLARY"</span>,</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>         description <span class="sc">==</span> <span class="st">"FORCIBLE ENTRY"</span>,</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>         <span class="sc">!</span><span class="fu">is.na</span>(longitude), <span class="sc">!</span><span class="fu">is.na</span>(latitude)) <span class="sc">%&gt;%</span></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">year</span>(<span class="fu">as_date</span>(date)))</span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"2018 burglary (FORCIBLE ENTRY) incidents:"</span>, </span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">nrow</span>(crime_2018_burg), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>2018 burglary (FORCIBLE ENTRY) incidents: 26 </code></pre>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>crime_2018_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>  crime_2018_burg,</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"longitude"</span>, <span class="st">"latitude"</span>),</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">crs =</span> <span class="dv">4326</span></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="fu">st_crs</span>(fishnet))</span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>counts_crime_2018 <span class="ot">&lt;-</span> <span class="fu">st_join</span>(fishnet, crime_2018_sf, <span class="at">join =</span> st_contains) <span class="sc">%&gt;%</span></span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(uniqueID, <span class="at">name =</span> <span class="st">"countCrime2018"</span>)</span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a>fishnet_crime_2018 <span class="ot">&lt;-</span> fishnet <span class="sc">%&gt;%</span></span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(counts_crime_2018, <span class="at">by =</span> <span class="st">"uniqueID"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">countCrime2018 =</span> <span class="fu">replace_na</span>(countCrime2018, <span class="dv">0</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>fishnet_crime_2018<span class="sc">$</span>predCrime <span class="ot">&lt;-</span> <span class="fu">predict</span>(</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>  model_nb,</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">newdata =</span> fishnet_crime_2018 <span class="sc">%&gt;%</span> <span class="fu">st_drop_geometry</span>(),</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"response"</span></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>fishnet_crime_2018 <span class="ot">&lt;-</span> fishnet_crime_2018 <span class="sc">%&gt;%</span></span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">error =</span> countCrime2018 <span class="sc">-</span> predCrime)</span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a>mae_crime <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">abs</span>(fishnet_crime_2018<span class="sc">$</span>error))</span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a>rmse_crime <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((fishnet_crime_2018<span class="sc">$</span>error)<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"2018 Burglary Temporal Validation → MAE:"</span>, <span class="fu">round</span>(mae_crime, <span class="dv">2</span>),</span>
<span id="cb73-14"><a href="#cb73-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">" RMSE:"</span>, <span class="fu">round</span>(rmse_crime, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>2018 Burglary Temporal Validation → MAE: 8.58  RMSE: 11.72 </code></pre>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> chicagoBoundary, <span class="at">fill =</span> <span class="st">"gray95"</span>, <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> fishnet_crime_2018, <span class="fu">aes</span>(<span class="at">fill =</span> error), <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient2</span>(<span class="at">low =</span> <span class="st">"#2c7bb6"</span>, <span class="at">mid =</span> <span class="st">"white"</span>, <span class="at">high =</span> <span class="st">"#d7191c"</span>,</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">midpoint =</span> <span class="dv">0</span>, <span class="at">name =</span> <span class="st">"Error (Obs - Pred)"</span>) <span class="sc">+</span></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"2018 Burglary (FORCIBLE ENTRY) Prediction Errors"</span>,</span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Predicted using 2017 Sanitation Model"</span>,</span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">"Blue = Overprediction, Red = Underprediction"</span>) <span class="sc">+</span></span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"gray40"</span>)</span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Luciano_Lu_assignment4_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The 2018 burglary prediction errors show systematic overprediction (predicted counts higher than observed), indicating limited transferability of the sanitation-based model to crime patterns. Moreover, the Poisson model was found to be overdispersed (variance ≫ mean), justifying the use of a Negative Binomial specification, which effectively reweights the variance structure to better model spatially heterogeneous count data.</p>
</section>
</section>
<section id="step-3-analysis" class="level2">
<h2 class="anchored" data-anchor-id="step-3-analysis">Step 3: Analysis</h2>
<section id="overview" class="level3">
<h3 class="anchored" data-anchor-id="overview">Overview</h3>
<p>This project builds a spatial predictive model of sanitation-related 311 service requests in Chicago for 2017–2018. Using a 500 m × 500 m fishnet grid as the spatial unit, the analysis combines descriptive mapping, spatial autocorrelation diagnostics, and count regression models to understand and predict the geographic distribution of sanitation code violations.</p>
<p>Spatial clustering and model diagnostics show that these urban service complaints are not randomly distributed. Instead, they exhibit strong spatial dependence—particularly along the South and West Sides—reflecting the persistence of neighborhood-level environmental and socioeconomic inequalities.</p>
<hr>
</section>
<section id="spatial-clustering" class="level3">
<h3 class="anchored" data-anchor-id="spatial-clustering">1. Spatial Clustering</h3>
<p>Exploratory mapping revealed clear spatial concentrations of sanitation violations. Local Moran’s I confirmed statistically significant <strong>High-High clusters</strong> (hotspots) in central-west and south-side neighborhoods, while <strong>Low-Low clusters</strong> occurred in more peripheral or affluent areas.<br>
This indicates that sanitation complaints follow patterns of older housing stock, population turnover, and varying municipal service responsiveness.</p>
<hr>
</section>
<section id="count-regression-modeling" class="level3">
<h3 class="anchored" data-anchor-id="count-regression-modeling">2. Count Regression Modeling</h3>
<p>Both Poisson and Negative Binomial (NB) count models were fit to predict the number of violations per grid cell using two spatial covariates:</p>
<ul>
<li><strong>Mean distance to nearest 3 sanitation events (nn_meanDist)</strong></li>
<li><strong>Distance to the nearest high-high cluster centroid (dist_to_hotspot)</strong></li>
</ul>
<p>The Poisson model exhibited <strong>overdispersion</strong> (dispersion = 4.54 ≫ 1.5), meaning that the variance of counts greatly exceeded the mean.<br>
The NB model corrected this issue and achieved a much better fit (AIC = 11 212 vs 14 422 for Poisson), validating the choice of a variance-adjusted count specification.<br>
Both predictors were significantly negative, showing that proximity to existing violations and hotspots strongly increases expected complaint frequency.</p>
<hr>
</section>
<section id="spatial-cross-validation-2017" class="level3">
<h3 class="anchored" data-anchor-id="spatial-cross-validation-2017">3. Spatial Cross-Validation (2017)</h3>
<p>A <strong>Leave-One-District-Out (LOGO)</strong> cross-validation using Chicago’s 22 police districts assessed spatial generalizability.<br>
The model achieved <strong>Mean MAE = 4.67</strong> and <strong>Mean RMSE = 7.74</strong>, confirming moderate predictive power in unseen areas.<br>
Prediction errors were larger in dense downtown and inner-south districts, highlighting the spatial heterogeneity of urban sanitation behavior.</p>
<hr>
</section>
<section id="temporal-validation-2018" class="level3">
<h3 class="anchored" data-anchor-id="temporal-validation-2018">4. Temporal Validation (2018)</h3>
<p>Applying the 2017 NB model to 2018 sanitation data yielded <strong>MAE = 5.05</strong> and <strong>RMSE = 7.84</strong>, outperforming a non-parametric <strong>KDE baseline</strong> (MAE = 8.67, RMSE = 12.55).<br>
The model successfully generalized across years, indicating that neighborhood-level structural factors—rather than year-specific policy noise—drive much of the spatial pattern in 311 sanitation requests.</p>
<p>The 2018 error map showed: - <strong>Blue areas (overprediction)</strong> around southern and western peripheries<br>
- <strong>Red areas (underprediction)</strong> concentrated in inner neighborhoods where new complaints emerged in 2018</p>
<p>These differences likely stem from unmodeled local dynamics such as inspection intensity, redevelopment, or seasonal population change.</p>
<hr>
</section>
<section id="challenge-task-cross-domain-validation-2018-burglary" class="level3">
<h3 class="anchored" data-anchor-id="challenge-task-cross-domain-validation-2018-burglary">5. Challenge Task: Cross-Domain Validation (2018 Burglary)</h3>
<p>The 2017 sanitation model was tested on <strong>2018 burglary (forcible entry)</strong> events to evaluate cross-domain transferability.<br>
Results showed systematic <strong>overprediction</strong> across most grid cells, meaning that the model assumed crime would occur with similar spatial intensity as sanitation violations.<br>
This demonstrates that while spatial autocorrelation structures are similar across urban phenomena, the underlying generative mechanisms (social, behavioral, or policing factors) differ substantially.</p>
<p>Such overprediction underscores the <strong>domain specificity</strong> of spatial count processes and the importance of incorporating domain-relevant variables when extending predictive models to new phenomena.</p>
<hr>
</section>
<section id="interpretation" class="level3">
<h3 class="anchored" data-anchor-id="interpretation">6. Interpretation</h3>
<ol type="1">
<li><strong>Spatial dependence matters:</strong> Incorporating local spatial features (e.g., nearest-neighbor distances) substantially improves prediction over simple density persistence models.<br>
</li>
<li><strong>Overdispersion is the rule, not the exception:</strong> Urban event counts rarely meet Poisson variance assumptions; the Negative Binomial model offers a practical correction by weighting variance heterogeneity.<br>
</li>
<li><strong>Temporal generalization is feasible:</strong> Structural neighborhood effects remain stable across years.<br>
</li>
<li><strong>Cross-domain generalization is limited:</strong> Models trained on sanitation data poorly capture crime patterns, revealing that social drivers differ even when spatial clustering appears similar.</li>
</ol>
<hr>
<p>Spatially explicit predictive modeling of 311 sanitation complaints can help city agencies prioritize inspection and maintenance resources more efficiently.<br>
However, models must remain adaptive—incorporating updated data, temporal shifts, and behavioral heterogeneity—to avoid reinforcing historical inequalities in service delivery.<br>
For broader urban analytics, this exercise shows both the potential and the limits of spatial transfer learning in complex social environments.</p>


<!-- -->

</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb76" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Spatial Predictive Modeling – Sanitation 311 Requests"</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> "MUSA 5080 – Fall 2025"</span></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Jingqi Lu"</span></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> today</span></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: show</span></span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-depth: 3</span></span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-location: left</span></span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a><span class="co">    theme: cosmo</span></span>
<span id="cb76-14"><a href="#cb76-14" aria-hidden="true" tabindex="-1"></a><span class="co">    embed-resources: true</span></span>
<span id="cb76-15"><a href="#cb76-15" aria-hidden="true" tabindex="-1"></a><span class="an">editor:</span><span class="co"> visual</span></span>
<span id="cb76-16"><a href="#cb76-16" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span></span>
<span id="cb76-17"><a href="#cb76-17" aria-hidden="true" tabindex="-1"></a><span class="co">  warning: false</span></span>
<span id="cb76-18"><a href="#cb76-18" aria-hidden="true" tabindex="-1"></a><span class="co">  message: false</span></span>
<span id="cb76-19"><a href="#cb76-19" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb76-20"><a href="#cb76-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-21"><a href="#cb76-21" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup, include=FALSE}</span></span>
<span id="cb76-22"><a href="#cb76-22" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(</span>
<span id="cb76-23"><a href="#cb76-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">message =</span> <span class="cn">FALSE</span>,</span>
<span id="cb76-24"><a href="#cb76-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">warning =</span> <span class="cn">FALSE</span></span>
<span id="cb76-25"><a href="#cb76-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb76-26"><a href="#cb76-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-27"><a href="#cb76-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Packages</span></span>
<span id="cb76-28"><a href="#cb76-28" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb76-29"><a href="#cb76-29" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb76-30"><a href="#cb76-30" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb76-31"><a href="#cb76-31" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spatstat.geom)</span>
<span id="cb76-32"><a href="#cb76-32" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spatstat.explore)</span>
<span id="cb76-33"><a href="#cb76-33" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(terra)</span>
<span id="cb76-34"><a href="#cb76-34" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(FNN)</span>
<span id="cb76-35"><a href="#cb76-35" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spdep)</span>
<span id="cb76-36"><a href="#cb76-36" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb76-37"><a href="#cb76-37" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb76-38"><a href="#cb76-38" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb76-39"><a href="#cb76-39" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb76-40"><a href="#cb76-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-41"><a href="#cb76-41" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">5080</span>)</span>
<span id="cb76-42"><a href="#cb76-42" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen =</span> <span class="dv">999</span>)</span>
<span id="cb76-43"><a href="#cb76-43" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb76-44"><a href="#cb76-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-45"><a href="#cb76-45" aria-hidden="true" tabindex="-1"></a><span class="fu">## Step 1: Choose sanitation complaints as predict data</span></span>
<span id="cb76-46"><a href="#cb76-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-47"><a href="#cb76-47" aria-hidden="true" tabindex="-1"></a>In this step, I subset the raw 311 sanitation requests to 2017 observations with valid geographic coordinates and project them to ESRI:102271, creating a clean point dataset of 19,733 violations for spatial analysis.</span>
<span id="cb76-48"><a href="#cb76-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-49"><a href="#cb76-49" aria-hidden="true" tabindex="-1"></a><span class="fu">### Getting the Data</span></span>
<span id="cb76-50"><a href="#cb76-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-53"><a href="#cb76-53" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb76-54"><a href="#cb76-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Save locally under /data/Sanitation.csv</span></span>
<span id="cb76-55"><a href="#cb76-55" aria-hidden="true" tabindex="-1"></a>sanitation_raw <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/Sanitation.csv"</span>)</span>
<span id="cb76-56"><a href="#cb76-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-57"><a href="#cb76-57" aria-hidden="true" tabindex="-1"></a><span class="co"># 1.2 Clean and convert to spatial points (keep necessary columns)</span></span>
<span id="cb76-58"><a href="#cb76-58" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjust variable names based on actual CSV field names</span></span>
<span id="cb76-59"><a href="#cb76-59" aria-hidden="true" tabindex="-1"></a>sanitation_sf <span class="ot">&lt;-</span> sanitation_raw <span class="sc">%&gt;%</span></span>
<span id="cb76-60"><a href="#cb76-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">CreationDate =</span> <span class="fu">mdy</span>(<span class="st">`</span><span class="at">Creation Date</span><span class="st">`</span>),</span>
<span id="cb76-61"><a href="#cb76-61" aria-hidden="true" tabindex="-1"></a>         <span class="at">Year =</span> <span class="fu">year</span>(CreationDate)) <span class="sc">%&gt;%</span></span>
<span id="cb76-62"><a href="#cb76-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Year <span class="sc">==</span> <span class="dv">2017</span>,</span>
<span id="cb76-63"><a href="#cb76-63" aria-hidden="true" tabindex="-1"></a>         <span class="sc">!</span><span class="fu">is.na</span>(Latitude), <span class="sc">!</span><span class="fu">is.na</span>(Longitude)) <span class="sc">%&gt;%</span></span>
<span id="cb76-64"><a href="#cb76-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"Longitude"</span>, <span class="st">"Latitude"</span>), <span class="at">crs =</span> <span class="dv">4326</span>) <span class="sc">%&gt;%</span></span>
<span id="cb76-65"><a href="#cb76-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="st">'ESRI:102271'</span>)</span>
<span id="cb76-66"><a href="#cb76-66" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb76-67"><a href="#cb76-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-68"><a href="#cb76-68" aria-hidden="true" tabindex="-1"></a><span class="fu">## Step 2: Exploratory Spatial Analysis</span></span>
<span id="cb76-69"><a href="#cb76-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-70"><a href="#cb76-70" aria-hidden="true" tabindex="-1"></a>To analyze spatial variation in complaint intensity, I construct a 500 m × 500 m fishnet grid over Chicago, aggregate sanitation violations to each cell, and map the resulting count distribution.</span>
<span id="cb76-71"><a href="#cb76-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-72"><a href="#cb76-72" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Part 1: Data Loading &amp; Exploration</span></span>
<span id="cb76-73"><a href="#cb76-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-74"><a href="#cb76-74" aria-hidden="true" tabindex="-1"></a>In this part, I load the raw sanitation 311 service request data and the Chicago city boundary, then filter the requests to 2017 incidents with valid latitude–longitude coordinates. Both layers are projected into a common planar CRS (ESRI:102271) so that distances are measured in meters and are suitable for subsequent spatial analysis. The exploratory point map shows that sanitation code violations are far from uniformly distributed: they cluster along central, south, and west corridors of the city, while the North Side exhibits lighter, more scattered activity. This initial pattern already suggests strong spatial concentration of complaints and motivates a grid-based analysis of variation in complaint intensity across the city.</span>
<span id="cb76-75"><a href="#cb76-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-76"><a href="#cb76-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-79"><a href="#cb76-79" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb76-80"><a href="#cb76-80" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Chicago boundary for context</span></span>
<span id="cb76-81"><a href="#cb76-81" aria-hidden="true" tabindex="-1"></a>chicagoBoundary <span class="ot">&lt;-</span> <span class="fu">suppressMessages</span>(</span>
<span id="cb76-82"><a href="#cb76-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_read</span>(</span>
<span id="cb76-83"><a href="#cb76-83" aria-hidden="true" tabindex="-1"></a>    <span class="st">"https://raw.githubusercontent.com/urbanSpatial/Public-Policy-Analytics-Landing/master/DATA/Chapter5/chicagoBoundary.geojson"</span>,</span>
<span id="cb76-84"><a href="#cb76-84" aria-hidden="true" tabindex="-1"></a>    <span class="at">quiet =</span> <span class="cn">TRUE</span></span>
<span id="cb76-85"><a href="#cb76-85" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb76-86"><a href="#cb76-86" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb76-87"><a href="#cb76-87" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="st">"ESRI:102271"</span>)</span>
<span id="cb76-88"><a href="#cb76-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-89"><a href="#cb76-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-90"><a href="#cb76-90" aria-hidden="true" tabindex="-1"></a><span class="co"># Quick spatial plot: where are the violations located?</span></span>
<span id="cb76-91"><a href="#cb76-91" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb76-92"><a href="#cb76-92" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> chicagoBoundary, <span class="at">fill =</span> <span class="st">"gray95"</span>, <span class="at">color =</span> <span class="st">"gray60"</span>) <span class="sc">+</span></span>
<span id="cb76-93"><a href="#cb76-93" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> sanitation_sf, <span class="at">color =</span> <span class="st">"#d62828"</span>, <span class="at">size =</span> <span class="fl">0.1</span>, <span class="at">alpha =</span> <span class="fl">0.4</span>) <span class="sc">+</span></span>
<span id="cb76-94"><a href="#cb76-94" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb76-95"><a href="#cb76-95" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Spatial Distribution of Sanitation Code Violations in Chicago"</span>,</span>
<span id="cb76-96"><a href="#cb76-96" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="fu">paste0</span>(<span class="st">"2017, n = "</span>, <span class="fu">nrow</span>(sanitation_sf)),</span>
<span id="cb76-97"><a href="#cb76-97" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Source: Chicago 311 Service Requests (Open Data Portal)"</span></span>
<span id="cb76-98"><a href="#cb76-98" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb76-99"><a href="#cb76-99" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb76-100"><a href="#cb76-100" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb76-101"><a href="#cb76-101" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb76-102"><a href="#cb76-102" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"gray40"</span>)</span>
<span id="cb76-103"><a href="#cb76-103" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb76-104"><a href="#cb76-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-105"><a href="#cb76-105" aria-hidden="true" tabindex="-1"></a><span class="co"># Verify result</span></span>
<span id="cb76-106"><a href="#cb76-106" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"311 sanitation records for 2017:"</span>, <span class="fu">nrow</span>(sanitation_sf), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb76-107"><a href="#cb76-107" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb76-108"><a href="#cb76-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-109"><a href="#cb76-109" aria-hidden="true" tabindex="-1"></a>Violations cluster densely along the city’s central and southern corridors, especially on the South and West Sides. The North Side shows lighter, more scattered activity. Overall, incidents follow residential density and older housing patterns, revealing clear spatial concentration rather than uniform distribution.</span>
<span id="cb76-110"><a href="#cb76-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-111"><a href="#cb76-111" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Part 2: Fishnet Grid Creation</span></span>
<span id="cb76-112"><a href="#cb76-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-113"><a href="#cb76-113" aria-hidden="true" tabindex="-1"></a>Here I construct a 500 m × 500 m fishnet grid over Chicago, intersect it with the city boundary, and aggregate sanitation violations to each grid cell. This produces a count surface of sanitation complaints that standardizes the spatial unit of analysis across the entire city. </span>
<span id="cb76-114"><a href="#cb76-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-117"><a href="#cb76-117" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb76-118"><a href="#cb76-118" aria-hidden="true" tabindex="-1"></a>fishnet <span class="ot">&lt;-</span> <span class="fu">st_make_grid</span>(</span>
<span id="cb76-119"><a href="#cb76-119" aria-hidden="true" tabindex="-1"></a>  chicagoBoundary,</span>
<span id="cb76-120"><a href="#cb76-120" aria-hidden="true" tabindex="-1"></a>  <span class="at">cellsize =</span> <span class="dv">500</span>,   <span class="co"># 500 meters per cell</span></span>
<span id="cb76-121"><a href="#cb76-121" aria-hidden="true" tabindex="-1"></a>  <span class="at">square =</span> <span class="cn">TRUE</span></span>
<span id="cb76-122"><a href="#cb76-122" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb76-123"><a href="#cb76-123" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_sf</span>() <span class="sc">%&gt;%</span></span>
<span id="cb76-124"><a href="#cb76-124" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">uniqueID =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb76-125"><a href="#cb76-125" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">lengths</span>(<span class="fu">st_intersects</span>(., chicagoBoundary)) <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb76-126"><a href="#cb76-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-127"><a href="#cb76-127" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"✓ Created fishnet grid with"</span>, <span class="fu">nrow</span>(fishnet), <span class="st">"cells</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb76-128"><a href="#cb76-128" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb76-129"><a href="#cb76-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-132"><a href="#cb76-132" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb76-133"><a href="#cb76-133" aria-hidden="true" tabindex="-1"></a>sanitation_count <span class="ot">&lt;-</span> <span class="fu">st_join</span>(sanitation_sf, fishnet, <span class="at">join =</span> st_within) <span class="sc">%&gt;%</span></span>
<span id="cb76-134"><a href="#cb76-134" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb76-135"><a href="#cb76-135" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(uniqueID) <span class="sc">%&gt;%</span></span>
<span id="cb76-136"><a href="#cb76-136" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">countSanitation =</span> <span class="fu">n</span>())</span>
<span id="cb76-137"><a href="#cb76-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-138"><a href="#cb76-138" aria-hidden="true" tabindex="-1"></a>fishnet <span class="ot">&lt;-</span> fishnet <span class="sc">%&gt;%</span></span>
<span id="cb76-139"><a href="#cb76-139" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(sanitation_count, <span class="at">by =</span> <span class="st">"uniqueID"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb76-140"><a href="#cb76-140" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">countSanitation =</span> <span class="fu">replace_na</span>(countSanitation, <span class="dv">0</span>))</span>
<span id="cb76-141"><a href="#cb76-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-142"><a href="#cb76-142" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fishnet<span class="sc">$</span>countSanitation)</span>
<span id="cb76-143"><a href="#cb76-143" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb76-144"><a href="#cb76-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-147"><a href="#cb76-147" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb76-148"><a href="#cb76-148" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb76-149"><a href="#cb76-149" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> fishnet, <span class="fu">aes</span>(<span class="at">fill =</span> countSanitation), <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb76-150"><a href="#cb76-150" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> chicagoBoundary, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">linewidth =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb76-151"><a href="#cb76-151" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(</span>
<span id="cb76-152"><a href="#cb76-152" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Violations"</span>,</span>
<span id="cb76-153"><a href="#cb76-153" aria-hidden="true" tabindex="-1"></a>    <span class="at">option =</span> <span class="st">"plasma"</span>,</span>
<span id="cb76-154"><a href="#cb76-154" aria-hidden="true" tabindex="-1"></a>    <span class="at">trans =</span> <span class="st">"sqrt"</span>,</span>
<span id="cb76-155"><a href="#cb76-155" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">40</span>)</span>
<span id="cb76-156"><a href="#cb76-156" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb76-157"><a href="#cb76-157" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb76-158"><a href="#cb76-158" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Sanitation Code Violations by 500m Grid Cell"</span>,</span>
<span id="cb76-159"><a href="#cb76-159" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Chicago, 2017"</span>,</span>
<span id="cb76-160"><a href="#cb76-160" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Source: Chicago 311 Service Requests (Open Data Portal)"</span></span>
<span id="cb76-161"><a href="#cb76-161" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb76-162"><a href="#cb76-162" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb76-163"><a href="#cb76-163" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb76-164"><a href="#cb76-164" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb76-165"><a href="#cb76-165" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"gray40"</span>),</span>
<span id="cb76-166"><a href="#cb76-166" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb76-167"><a href="#cb76-167" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb76-168"><a href="#cb76-168" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid =</span> <span class="fu">element_blank</span>()</span>
<span id="cb76-169"><a href="#cb76-169" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb76-170"><a href="#cb76-170" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb76-171"><a href="#cb76-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-172"><a href="#cb76-172" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Part 3: Spatial Features</span></span>
<span id="cb76-173"><a href="#cb76-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-174"><a href="#cb76-174" aria-hidden="true" tabindex="-1"></a>To capture local spatial context, I derive two key features for each grid cell: the mean distance to the three nearest sanitation events (nn_meanDist) and the distance to the nearest High–High hotspot centroid (dist_to_hotspot). Smaller values of these features indicate tighter clustering of complaints around the cell or closer proximity to a major hotspot. </span>
<span id="cb76-175"><a href="#cb76-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-178"><a href="#cb76-178" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb76-179"><a href="#cb76-179" aria-hidden="true" tabindex="-1"></a>fishnet_centroids <span class="ot">&lt;-</span> <span class="fu">st_centroid</span>(fishnet)</span>
<span id="cb76-180"><a href="#cb76-180" aria-hidden="true" tabindex="-1"></a>san_coords <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(sanitation_sf)</span>
<span id="cb76-181"><a href="#cb76-181" aria-hidden="true" tabindex="-1"></a>fish_coords <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(fishnet_centroids)</span>
<span id="cb76-182"><a href="#cb76-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-183"><a href="#cb76-183" aria-hidden="true" tabindex="-1"></a>nn_result <span class="ot">&lt;-</span> <span class="fu">get.knnx</span>(san_coords, fish_coords, <span class="at">k =</span> <span class="dv">3</span>)</span>
<span id="cb76-184"><a href="#cb76-184" aria-hidden="true" tabindex="-1"></a>fishnet<span class="sc">$</span>nn_meanDist <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(nn_result<span class="sc">$</span>nn.dist)</span>
<span id="cb76-185"><a href="#cb76-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-186"><a href="#cb76-186" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fishnet<span class="sc">$</span>nn_meanDist)</span>
<span id="cb76-187"><a href="#cb76-187" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"✓ Added 3-NN mean distance feature</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb76-188"><a href="#cb76-188" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb76-189"><a href="#cb76-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-192"><a href="#cb76-192" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb76-193"><a href="#cb76-193" aria-hidden="true" tabindex="-1"></a>coords <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(fishnet_centroids)</span>
<span id="cb76-194"><a href="#cb76-194" aria-hidden="true" tabindex="-1"></a>nb <span class="ot">&lt;-</span> <span class="fu">knn2nb</span>(<span class="fu">knearneigh</span>(coords, <span class="at">k =</span> <span class="dv">5</span>))</span>
<span id="cb76-195"><a href="#cb76-195" aria-hidden="true" tabindex="-1"></a>lw <span class="ot">&lt;-</span> <span class="fu">nb2listw</span>(nb, <span class="at">style =</span> <span class="st">"W"</span>, <span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb76-196"><a href="#cb76-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-197"><a href="#cb76-197" aria-hidden="true" tabindex="-1"></a>localM <span class="ot">&lt;-</span> <span class="fu">localmoran</span>(fishnet<span class="sc">$</span>countSanitation, lw)</span>
<span id="cb76-198"><a href="#cb76-198" aria-hidden="true" tabindex="-1"></a>mean_val <span class="ot">&lt;-</span> <span class="fu">mean</span>(fishnet<span class="sc">$</span>countSanitation, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb76-199"><a href="#cb76-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-200"><a href="#cb76-200" aria-hidden="true" tabindex="-1"></a>fishnet <span class="ot">&lt;-</span> fishnet <span class="sc">%&gt;%</span></span>
<span id="cb76-201"><a href="#cb76-201" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb76-202"><a href="#cb76-202" aria-hidden="true" tabindex="-1"></a>    <span class="at">localI =</span> localM[, <span class="dv">1</span>],</span>
<span id="cb76-203"><a href="#cb76-203" aria-hidden="true" tabindex="-1"></a>    <span class="at">p_value =</span> localM[, <span class="dv">5</span>],</span>
<span id="cb76-204"><a href="#cb76-204" aria-hidden="true" tabindex="-1"></a>    <span class="at">significant =</span> p_value <span class="sc">&lt;</span> <span class="fl">0.05</span>,</span>
<span id="cb76-205"><a href="#cb76-205" aria-hidden="true" tabindex="-1"></a>    <span class="at">clusterType =</span> <span class="fu">case_when</span>(</span>
<span id="cb76-206"><a href="#cb76-206" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!</span>significant <span class="sc">~</span> <span class="st">"Not Significant"</span>,</span>
<span id="cb76-207"><a href="#cb76-207" aria-hidden="true" tabindex="-1"></a>      localI <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> countSanitation <span class="sc">&gt;</span> mean_val <span class="sc">~</span> <span class="st">"High-High"</span>,</span>
<span id="cb76-208"><a href="#cb76-208" aria-hidden="true" tabindex="-1"></a>      localI <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> countSanitation <span class="sc">&lt;=</span> mean_val <span class="sc">~</span> <span class="st">"Low-Low"</span>,</span>
<span id="cb76-209"><a href="#cb76-209" aria-hidden="true" tabindex="-1"></a>      localI <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> countSanitation <span class="sc">&gt;</span> mean_val <span class="sc">~</span> <span class="st">"High-Low"</span>,</span>
<span id="cb76-210"><a href="#cb76-210" aria-hidden="true" tabindex="-1"></a>      localI <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> countSanitation <span class="sc">&lt;=</span> mean_val <span class="sc">~</span> <span class="st">"Low-High"</span>,</span>
<span id="cb76-211"><a href="#cb76-211" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Not Significant"</span></span>
<span id="cb76-212"><a href="#cb76-212" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb76-213"><a href="#cb76-213" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb76-214"><a href="#cb76-214" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb76-215"><a href="#cb76-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-218"><a href="#cb76-218" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb76-219"><a href="#cb76-219" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb76-220"><a href="#cb76-220" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> fishnet, <span class="fu">aes</span>(<span class="at">fill =</span> clusterType), <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb76-221"><a href="#cb76-221" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(</span>
<span id="cb76-222"><a href="#cb76-222" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb76-223"><a href="#cb76-223" aria-hidden="true" tabindex="-1"></a>      <span class="st">"High-High"</span> <span class="ot">=</span> <span class="st">"#d7191c"</span>,</span>
<span id="cb76-224"><a href="#cb76-224" aria-hidden="true" tabindex="-1"></a>      <span class="st">"High-Low"</span>  <span class="ot">=</span> <span class="st">"#fdae61"</span>,</span>
<span id="cb76-225"><a href="#cb76-225" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Low-High"</span>  <span class="ot">=</span> <span class="st">"#abd9e9"</span>,</span>
<span id="cb76-226"><a href="#cb76-226" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Low-Low"</span>   <span class="ot">=</span> <span class="st">"#2c7bb6"</span>,</span>
<span id="cb76-227"><a href="#cb76-227" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Not Significant"</span> <span class="ot">=</span> <span class="st">"gray90"</span></span>
<span id="cb76-228"><a href="#cb76-228" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb76-229"><a href="#cb76-229" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Cluster Type"</span></span>
<span id="cb76-230"><a href="#cb76-230" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb76-231"><a href="#cb76-231" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb76-232"><a href="#cb76-232" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Local Moran’s I: Sanitation Violation Clusters"</span>,</span>
<span id="cb76-233"><a href="#cb76-233" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"High-High = Hot Spots  |  Low-Low = Cold Spots"</span></span>
<span id="cb76-234"><a href="#cb76-234" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb76-235"><a href="#cb76-235" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb76-236"><a href="#cb76-236" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb76-237"><a href="#cb76-237" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb76-238"><a href="#cb76-238" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"gray40"</span>)</span>
<span id="cb76-239"><a href="#cb76-239" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb76-240"><a href="#cb76-240" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb76-241"><a href="#cb76-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-242"><a href="#cb76-242" aria-hidden="true" tabindex="-1"></a>Hot spots (High-High clusters) of sanitation violations concentrate mainly in the central-west and south-side neighborhoods, with small pockets on the far north and southwest. Cold or low-activity areas dominate the rest of the city. The pattern suggests that sanitation issues are spatially clustered rather than random, aligning with older, denser residential zones and areas of higher population turnover.</span>
<span id="cb76-243"><a href="#cb76-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-246"><a href="#cb76-246" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb76-247"><a href="#cb76-247" aria-hidden="true" tabindex="-1"></a>hotspots <span class="ot">&lt;-</span> fishnet <span class="sc">%&gt;%</span></span>
<span id="cb76-248"><a href="#cb76-248" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(clusterType <span class="sc">==</span> <span class="st">"High-High"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb76-249"><a href="#cb76-249" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_centroid</span>()</span>
<span id="cb76-250"><a href="#cb76-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-251"><a href="#cb76-251" aria-hidden="true" tabindex="-1"></a>fishnet<span class="sc">$</span>dist_to_hotspot <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(</span>
<span id="cb76-252"><a href="#cb76-252" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_distance</span>(fishnet_centroids, hotspots <span class="sc">%&gt;%</span> <span class="fu">st_union</span>())</span>
<span id="cb76-253"><a href="#cb76-253" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb76-254"><a href="#cb76-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-255"><a href="#cb76-255" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fishnet<span class="sc">$</span>dist_to_hotspot)</span>
<span id="cb76-256"><a href="#cb76-256" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Calculated distance to nearest High-High cluster</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb76-257"><a href="#cb76-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-258"><a href="#cb76-258" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb76-259"><a href="#cb76-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-260"><a href="#cb76-260" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Part 4: Count Regression Models</span></span>
<span id="cb76-261"><a href="#cb76-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-262"><a href="#cb76-262" aria-hidden="true" tabindex="-1"></a>In this part, I fit Poisson and Negative Binomial count regression models to explain variation in sanitation complaint counts per grid cell using the two spatial features. </span>
<span id="cb76-263"><a href="#cb76-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-266"><a href="#cb76-266" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb76-267"><a href="#cb76-267" aria-hidden="true" tabindex="-1"></a>fishnet_model <span class="ot">&lt;-</span> fishnet <span class="sc">%&gt;%</span></span>
<span id="cb76-268"><a href="#cb76-268" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb76-269"><a href="#cb76-269" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb76-270"><a href="#cb76-270" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(uniqueID, countSanitation, nn_meanDist, dist_to_hotspot) <span class="sc">%&gt;%</span></span>
<span id="cb76-271"><a href="#cb76-271" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">drop_na</span>()</span>
<span id="cb76-272"><a href="#cb76-272" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"✓ Modeling dataset ready with"</span>, <span class="fu">nrow</span>(fishnet_model), <span class="st">"observations</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb76-273"><a href="#cb76-273" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb76-274"><a href="#cb76-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-277"><a href="#cb76-277" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb76-278"><a href="#cb76-278" aria-hidden="true" tabindex="-1"></a>model_pois <span class="ot">&lt;-</span> <span class="fu">glm</span>(</span>
<span id="cb76-279"><a href="#cb76-279" aria-hidden="true" tabindex="-1"></a>  countSanitation <span class="sc">~</span> nn_meanDist <span class="sc">+</span> dist_to_hotspot,</span>
<span id="cb76-280"><a href="#cb76-280" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> fishnet_model,</span>
<span id="cb76-281"><a href="#cb76-281" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="st">"poisson"</span></span>
<span id="cb76-282"><a href="#cb76-282" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb76-283"><a href="#cb76-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-284"><a href="#cb76-284" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_pois)</span>
<span id="cb76-285"><a href="#cb76-285" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb76-286"><a href="#cb76-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-289"><a href="#cb76-289" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb76-290"><a href="#cb76-290" aria-hidden="true" tabindex="-1"></a>dispersion <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">residuals</span>(model_pois, <span class="at">type =</span> <span class="st">"pearson"</span>)<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span></span>
<span id="cb76-291"><a href="#cb76-291" aria-hidden="true" tabindex="-1"></a>              model_pois<span class="sc">$</span>df.residual</span>
<span id="cb76-292"><a href="#cb76-292" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Dispersion parameter:"</span>, <span class="fu">round</span>(dispersion, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb76-293"><a href="#cb76-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-294"><a href="#cb76-294" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (dispersion <span class="sc">&gt;</span> <span class="fl">1.5</span>) {</span>
<span id="cb76-295"><a href="#cb76-295" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"⚠ Overdispersion detected — Negative Binomial model recommended.</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb76-296"><a href="#cb76-296" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb76-297"><a href="#cb76-297" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"✓ Dispersion acceptable for Poisson model.</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb76-298"><a href="#cb76-298" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb76-299"><a href="#cb76-299" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb76-300"><a href="#cb76-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-303"><a href="#cb76-303" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb76-304"><a href="#cb76-304" aria-hidden="true" tabindex="-1"></a>model_nb <span class="ot">&lt;-</span> <span class="fu">glm.nb</span>(</span>
<span id="cb76-305"><a href="#cb76-305" aria-hidden="true" tabindex="-1"></a>  countSanitation <span class="sc">~</span> nn_meanDist <span class="sc">+</span> dist_to_hotspot,</span>
<span id="cb76-306"><a href="#cb76-306" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> fishnet_model</span>
<span id="cb76-307"><a href="#cb76-307" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb76-308"><a href="#cb76-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-309"><a href="#cb76-309" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_nb)</span>
<span id="cb76-310"><a href="#cb76-310" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb76-311"><a href="#cb76-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-314"><a href="#cb76-314" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb76-315"><a href="#cb76-315" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Model Fit Comparison:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb76-316"><a href="#cb76-316" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Poisson AIC:"</span>, <span class="fu">round</span>(<span class="fu">AIC</span>(model_pois), <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb76-317"><a href="#cb76-317" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"NegBin  AIC:"</span>, <span class="fu">round</span>(<span class="fu">AIC</span>(model_nb), <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb76-318"><a href="#cb76-318" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb76-319"><a href="#cb76-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-320"><a href="#cb76-320" aria-hidden="true" tabindex="-1"></a>The Poisson model showed clear overdispersion (dispersion = 4.54 <span class="sc">\&gt;</span> 1.5). The Negative Binomial model substantially improved fit (AIC = 11 212 vs 14 422). Both predictors were highly significant and negative: greater distance to nearby violations or to cluster centers corresponds to fewer sanitation code violations. This pattern indicates spatial clustering of violations within central and southern neighborhoods.</span>
<span id="cb76-321"><a href="#cb76-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-322"><a href="#cb76-322" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Part 5: Spatial Cross-Validation (2017)</span></span>
<span id="cb76-323"><a href="#cb76-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-324"><a href="#cb76-324" aria-hidden="true" tabindex="-1"></a>To evaluate spatial generalization, I implement a Leave-One-District-Out (LOGO) cross-validation using Chicago’s 22 police districts as spatial folds. </span>
<span id="cb76-325"><a href="#cb76-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-328"><a href="#cb76-328" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb76-329"><a href="#cb76-329" aria-hidden="true" tabindex="-1"></a>policeDistricts <span class="ot">&lt;-</span> <span class="fu">suppressMessages</span>(</span>
<span id="cb76-330"><a href="#cb76-330" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_read</span>(</span>
<span id="cb76-331"><a href="#cb76-331" aria-hidden="true" tabindex="-1"></a>    <span class="st">"https://data.cityofchicago.org/api/geospatial/24zt-jpfn?method=export&amp;format=GeoJSON"</span>,</span>
<span id="cb76-332"><a href="#cb76-332" aria-hidden="true" tabindex="-1"></a>    <span class="at">quiet =</span> <span class="cn">TRUE</span></span>
<span id="cb76-333"><a href="#cb76-333" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb76-334"><a href="#cb76-334" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb76-335"><a href="#cb76-335" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="st">"ESRI:102271"</span>) <span class="sc">|&gt;</span></span>
<span id="cb76-336"><a href="#cb76-336" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="at">District =</span> dist_num)</span>
<span id="cb76-337"><a href="#cb76-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-338"><a href="#cb76-338" aria-hidden="true" tabindex="-1"></a>fishnet <span class="ot">&lt;-</span> <span class="fu">st_join</span>(fishnet, policeDistricts, <span class="at">join =</span> st_within, <span class="at">left =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb76-339"><a href="#cb76-339" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(District))</span>
<span id="cb76-340"><a href="#cb76-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-341"><a href="#cb76-341" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"✓ Joined police districts:"</span>, <span class="fu">length</span>(<span class="fu">unique</span>(fishnet<span class="sc">$</span>District)), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb76-342"><a href="#cb76-342" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb76-343"><a href="#cb76-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-346"><a href="#cb76-346" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb76-347"><a href="#cb76-347" aria-hidden="true" tabindex="-1"></a>fishnet_model <span class="ot">&lt;-</span> fishnet <span class="sc">%&gt;%</span></span>
<span id="cb76-348"><a href="#cb76-348" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb76-349"><a href="#cb76-349" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb76-350"><a href="#cb76-350" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(uniqueID, District, countSanitation, nn_meanDist, dist_to_hotspot) <span class="sc">%&gt;%</span></span>
<span id="cb76-351"><a href="#cb76-351" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">drop_na</span>()</span>
<span id="cb76-352"><a href="#cb76-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-353"><a href="#cb76-353" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Data ready for LOGO CV with"</span>, <span class="fu">nrow</span>(fishnet_model), <span class="st">"observations</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb76-354"><a href="#cb76-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-355"><a href="#cb76-355" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb76-356"><a href="#cb76-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-359"><a href="#cb76-359" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb76-360"><a href="#cb76-360" aria-hidden="true" tabindex="-1"></a>districts <span class="ot">&lt;-</span> <span class="fu">unique</span>(fishnet_model<span class="sc">$</span>District)</span>
<span id="cb76-361"><a href="#cb76-361" aria-hidden="true" tabindex="-1"></a>cv_results <span class="ot">&lt;-</span> <span class="fu">tibble</span>()</span>
<span id="cb76-362"><a href="#cb76-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-363"><a href="#cb76-363" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Running LOGO cross-validation across"</span>, <span class="fu">length</span>(districts), <span class="st">"districts...</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb76-364"><a href="#cb76-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-365"><a href="#cb76-365" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(districts)) {</span>
<span id="cb76-366"><a href="#cb76-366" aria-hidden="true" tabindex="-1"></a>  test_district <span class="ot">&lt;-</span> districts[i]</span>
<span id="cb76-367"><a href="#cb76-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-368"><a href="#cb76-368" aria-hidden="true" tabindex="-1"></a>  train_data <span class="ot">&lt;-</span> fishnet_model <span class="sc">%&gt;%</span> <span class="fu">filter</span>(District <span class="sc">!=</span> test_district)</span>
<span id="cb76-369"><a href="#cb76-369" aria-hidden="true" tabindex="-1"></a>  test_data  <span class="ot">&lt;-</span> fishnet_model <span class="sc">%&gt;%</span> <span class="fu">filter</span>(District <span class="sc">==</span> test_district)</span>
<span id="cb76-370"><a href="#cb76-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-371"><a href="#cb76-371" aria-hidden="true" tabindex="-1"></a>  model_cv <span class="ot">&lt;-</span> <span class="fu">glm.nb</span>(countSanitation <span class="sc">~</span> nn_meanDist <span class="sc">+</span> dist_to_hotspot, <span class="at">data =</span> train_data)</span>
<span id="cb76-372"><a href="#cb76-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-373"><a href="#cb76-373" aria-hidden="true" tabindex="-1"></a>  test_data <span class="ot">&lt;-</span> test_data <span class="sc">%&gt;%</span></span>
<span id="cb76-374"><a href="#cb76-374" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">prediction =</span> <span class="fu">predict</span>(model_cv, <span class="at">newdata =</span> test_data, <span class="at">type =</span> <span class="st">"response"</span>))</span>
<span id="cb76-375"><a href="#cb76-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-376"><a href="#cb76-376" aria-hidden="true" tabindex="-1"></a>  mae  <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">abs</span>(test_data<span class="sc">$</span>countSanitation <span class="sc">-</span> test_data<span class="sc">$</span>prediction))</span>
<span id="cb76-377"><a href="#cb76-377" aria-hidden="true" tabindex="-1"></a>  rmse <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((test_data<span class="sc">$</span>countSanitation <span class="sc">-</span> test_data<span class="sc">$</span>prediction)<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb76-378"><a href="#cb76-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-379"><a href="#cb76-379" aria-hidden="true" tabindex="-1"></a>  cv_results <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(cv_results, <span class="fu">tibble</span>(</span>
<span id="cb76-380"><a href="#cb76-380" aria-hidden="true" tabindex="-1"></a>    <span class="at">fold =</span> i,</span>
<span id="cb76-381"><a href="#cb76-381" aria-hidden="true" tabindex="-1"></a>    <span class="at">test_district =</span> test_district,</span>
<span id="cb76-382"><a href="#cb76-382" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_test =</span> <span class="fu">nrow</span>(test_data),</span>
<span id="cb76-383"><a href="#cb76-383" aria-hidden="true" tabindex="-1"></a>    <span class="at">MAE =</span> mae,</span>
<span id="cb76-384"><a href="#cb76-384" aria-hidden="true" tabindex="-1"></a>    <span class="at">RMSE =</span> rmse</span>
<span id="cb76-385"><a href="#cb76-385" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb76-386"><a href="#cb76-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-387"><a href="#cb76-387" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"  Fold"</span>, i, <span class="st">"/"</span>, <span class="fu">length</span>(districts), </span>
<span id="cb76-388"><a href="#cb76-388" aria-hidden="true" tabindex="-1"></a>      <span class="st">"- District"</span>, test_district, </span>
<span id="cb76-389"><a href="#cb76-389" aria-hidden="true" tabindex="-1"></a>      <span class="st">"- MAE:"</span>, <span class="fu">round</span>(mae, <span class="dv">2</span>), </span>
<span id="cb76-390"><a href="#cb76-390" aria-hidden="true" tabindex="-1"></a>      <span class="st">"- RMSE:"</span>, <span class="fu">round</span>(rmse, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb76-391"><a href="#cb76-391" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb76-392"><a href="#cb76-392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-393"><a href="#cb76-393" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb76-394"><a href="#cb76-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-397"><a href="#cb76-397" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb76-398"><a href="#cb76-398" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">LOGO Cross-Validation complete</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb76-399"><a href="#cb76-399" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Mean MAE :"</span>, <span class="fu">round</span>(<span class="fu">mean</span>(cv_results<span class="sc">$</span>MAE), <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb76-400"><a href="#cb76-400" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Mean RMSE:"</span>, <span class="fu">round</span>(<span class="fu">mean</span>(cv_results<span class="sc">$</span>RMSE), <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb76-401"><a href="#cb76-401" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb76-402"><a href="#cb76-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-405"><a href="#cb76-405" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb76-406"><a href="#cb76-406" aria-hidden="true" tabindex="-1"></a>cv_results <span class="sc">%&gt;%</span></span>
<span id="cb76-407"><a href="#cb76-407" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(MAE)) <span class="sc">%&gt;%</span></span>
<span id="cb76-408"><a href="#cb76-408" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(</span>
<span id="cb76-409"><a href="#cb76-409" aria-hidden="true" tabindex="-1"></a>    <span class="at">digits =</span> <span class="dv">2</span>,</span>
<span id="cb76-410"><a href="#cb76-410" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Leave-One-District-Out Cross-Validation Results"</span></span>
<span id="cb76-411"><a href="#cb76-411" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb76-412"><a href="#cb76-412" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>))</span>
<span id="cb76-413"><a href="#cb76-413" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb76-414"><a href="#cb76-414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-415"><a href="#cb76-415" aria-hidden="true" tabindex="-1"></a>To evaluate the spatial generalization of the model, a Leave-One-District-Out (LOGO) cross-validation was implemented using Chicago’s 22 police districts as spatial groups. In each fold, one district was held out for testing while the Negative Binomial model was trained on the remaining districts.</span>
<span id="cb76-416"><a href="#cb76-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-417"><a href="#cb76-417" aria-hidden="true" tabindex="-1"></a>Across all 22 folds, the model achieved an average Mean Absolute Error (MAE) of 4.67 and a Root Mean Squared Error (RMSE) of 7.74. These results indicate that the model performs reasonably well in predicting sanitation code violation counts for spatially unseen districts. Errors tend to be larger in central and high-density districts, reflecting the underlying spatial heterogeneity of urban sanitation violations.</span>
<span id="cb76-418"><a href="#cb76-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-419"><a href="#cb76-419" aria-hidden="true" tabindex="-1"></a>Overall, the LOGO cross-validation confirms that the model captures meaningful spatial patterns and maintains moderate predictive accuracy across the city.</span>
<span id="cb76-420"><a href="#cb76-420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-421"><a href="#cb76-421" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Part 6: Model Evaluation</span></span>
<span id="cb76-422"><a href="#cb76-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-425"><a href="#cb76-425" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb76-426"><a href="#cb76-426" aria-hidden="true" tabindex="-1"></a>fishnet_model<span class="sc">$</span>pred_2017 <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_nb, <span class="at">newdata =</span> fishnet_model, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb76-427"><a href="#cb76-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-428"><a href="#cb76-428" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Generated in-sample predictions for 2017</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb76-429"><a href="#cb76-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-430"><a href="#cb76-430" aria-hidden="true" tabindex="-1"></a>sanitation_2018 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/Sanitation.csv"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb76-431"><a href="#cb76-431" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">CreationDate =</span> <span class="fu">mdy</span>(<span class="st">`</span><span class="at">Creation Date</span><span class="st">`</span>),</span>
<span id="cb76-432"><a href="#cb76-432" aria-hidden="true" tabindex="-1"></a>         <span class="at">Year =</span> <span class="fu">year</span>(CreationDate)) <span class="sc">%&gt;%</span></span>
<span id="cb76-433"><a href="#cb76-433" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Year <span class="sc">==</span> <span class="dv">2018</span>,</span>
<span id="cb76-434"><a href="#cb76-434" aria-hidden="true" tabindex="-1"></a>         <span class="sc">!</span><span class="fu">is.na</span>(Latitude), <span class="sc">!</span><span class="fu">is.na</span>(Longitude)) <span class="sc">%&gt;%</span></span>
<span id="cb76-435"><a href="#cb76-435" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"Longitude"</span>, <span class="st">"Latitude"</span>), <span class="at">crs =</span> <span class="dv">4326</span>) <span class="sc">%&gt;%</span></span>
<span id="cb76-436"><a href="#cb76-436" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="st">'ESRI:102271'</span>)</span>
<span id="cb76-437"><a href="#cb76-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-438"><a href="#cb76-438" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Loaded 2018 sanitation records:"</span>, <span class="fu">nrow</span>(sanitation_2018), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb76-439"><a href="#cb76-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-440"><a href="#cb76-440" aria-hidden="true" tabindex="-1"></a>fishnet_2018 <span class="ot">&lt;-</span> <span class="fu">st_join</span>(fishnet, sanitation_2018, <span class="at">join =</span> st_contains) <span class="sc">%&gt;%</span></span>
<span id="cb76-441"><a href="#cb76-441" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(uniqueID) <span class="sc">%&gt;%</span></span>
<span id="cb76-442"><a href="#cb76-442" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count2018 =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb76-443"><a href="#cb76-443" aria-hidden="true" tabindex="-1"></a>  <span class="fu">right_join</span>(fishnet_model, <span class="at">by =</span> <span class="st">"uniqueID"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb76-444"><a href="#cb76-444" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">count2018 =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(count2018), <span class="dv">0</span>, count2018))</span>
<span id="cb76-445"><a href="#cb76-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-446"><a href="#cb76-446" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Aggregated 2018 counts to fishnet grid</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb76-447"><a href="#cb76-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-448"><a href="#cb76-448" aria-hidden="true" tabindex="-1"></a>fishnet_2018<span class="sc">$</span>pred_2018 <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_nb, <span class="at">newdata =</span> fishnet_2018, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb76-449"><a href="#cb76-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-450"><a href="#cb76-450" aria-hidden="true" tabindex="-1"></a>fishnet_2018 <span class="ot">&lt;-</span> fishnet_2018 <span class="sc">%&gt;%</span></span>
<span id="cb76-451"><a href="#cb76-451" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">error =</span> count2018 <span class="sc">-</span> pred_2018)</span>
<span id="cb76-452"><a href="#cb76-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-453"><a href="#cb76-453" aria-hidden="true" tabindex="-1"></a>mae_2018 <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">abs</span>(fishnet_2018<span class="sc">$</span>error))</span>
<span id="cb76-454"><a href="#cb76-454" aria-hidden="true" tabindex="-1"></a>rmse_2018 <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((fishnet_2018<span class="sc">$</span>error)<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb76-455"><a href="#cb76-455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-456"><a href="#cb76-456" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"2018 Temporal Validation complete</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb76-457"><a href="#cb76-457" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"MAE (2018):"</span>, <span class="fu">round</span>(mae_2018, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb76-458"><a href="#cb76-458" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"RMSE (2018):"</span>, <span class="fu">round</span>(rmse_2018, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb76-459"><a href="#cb76-459" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb76-460"><a href="#cb76-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-463"><a href="#cb76-463" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb76-464"><a href="#cb76-464" aria-hidden="true" tabindex="-1"></a>points2017 <span class="ot">&lt;-</span> sanitation_sf <span class="sc">%&gt;%</span></span>
<span id="cb76-465"><a href="#cb76-465" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_coordinates</span>() <span class="sc">%&gt;%</span></span>
<span id="cb76-466"><a href="#cb76-466" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb76-467"><a href="#cb76-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-468"><a href="#cb76-468" aria-hidden="true" tabindex="-1"></a>kde_2017 <span class="ot">&lt;-</span> spatstat.geom<span class="sc">::</span><span class="fu">ppp</span>(points2017<span class="sc">$</span>X, points2017<span class="sc">$</span>Y,</span>
<span id="cb76-469"><a href="#cb76-469" aria-hidden="true" tabindex="-1"></a>                               <span class="at">window =</span> spatstat.geom<span class="sc">::</span><span class="fu">as.owin</span>(<span class="fu">st_union</span>(chicagoBoundary)))</span>
<span id="cb76-470"><a href="#cb76-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-471"><a href="#cb76-471" aria-hidden="true" tabindex="-1"></a>kde_density <span class="ot">&lt;-</span> spatstat.explore<span class="sc">::</span><span class="fu">density.ppp</span>(kde_2017, <span class="at">sigma =</span> <span class="dv">1000</span>) <span class="co"># bandwidth 1km</span></span>
<span id="cb76-472"><a href="#cb76-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-473"><a href="#cb76-473" aria-hidden="true" tabindex="-1"></a>fishnet_2018<span class="sc">$</span>kde_pred <span class="ot">&lt;-</span> raster<span class="sc">::</span><span class="fu">extract</span>(raster<span class="sc">::</span><span class="fu">raster</span>(kde_density), </span>
<span id="cb76-474"><a href="#cb76-474" aria-hidden="true" tabindex="-1"></a>                                         <span class="fu">st_coordinates</span>(<span class="fu">st_centroid</span>(fishnet)))</span>
<span id="cb76-475"><a href="#cb76-475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-476"><a href="#cb76-476" aria-hidden="true" tabindex="-1"></a>kde_mae  <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">abs</span>(fishnet_2018<span class="sc">$</span>count2018 <span class="sc">-</span> fishnet_2018<span class="sc">$</span>kde_pred), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb76-477"><a href="#cb76-477" aria-hidden="true" tabindex="-1"></a>kde_rmse <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((fishnet_2018<span class="sc">$</span>count2018 <span class="sc">-</span> fishnet_2018<span class="sc">$</span>kde_pred)<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb76-478"><a href="#cb76-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-479"><a href="#cb76-479" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"KDE baseline complete</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb76-480"><a href="#cb76-480" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"KDE MAE:"</span>, <span class="fu">round</span>(kde_mae, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb76-481"><a href="#cb76-481" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"KDE RMSE:"</span>, <span class="fu">round</span>(kde_rmse, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb76-482"><a href="#cb76-482" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb76-483"><a href="#cb76-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-486"><a href="#cb76-486" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb76-487"><a href="#cb76-487" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb76-488"><a href="#cb76-488" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> chicagoBoundary, <span class="at">fill =</span> <span class="st">"gray95"</span>, <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb76-489"><a href="#cb76-489" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> fishnet_2018, <span class="fu">aes</span>(<span class="at">fill =</span> error), <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb76-490"><a href="#cb76-490" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient2</span>(</span>
<span id="cb76-491"><a href="#cb76-491" aria-hidden="true" tabindex="-1"></a>    <span class="at">low =</span> <span class="st">"#2c7bb6"</span>,</span>
<span id="cb76-492"><a href="#cb76-492" aria-hidden="true" tabindex="-1"></a>    <span class="at">mid =</span> <span class="st">"white"</span>,</span>
<span id="cb76-493"><a href="#cb76-493" aria-hidden="true" tabindex="-1"></a>    <span class="at">high =</span> <span class="st">"#d7191c"</span>,</span>
<span id="cb76-494"><a href="#cb76-494" aria-hidden="true" tabindex="-1"></a>    <span class="at">midpoint =</span> <span class="dv">0</span>,</span>
<span id="cb76-495"><a href="#cb76-495" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Prediction Error"</span></span>
<span id="cb76-496"><a href="#cb76-496" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb76-497"><a href="#cb76-497" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb76-498"><a href="#cb76-498" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Prediction Errors for 2018 (Observed - Predicted)"</span>,</span>
<span id="cb76-499"><a href="#cb76-499" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Negative Binomial Model"</span>,</span>
<span id="cb76-500"><a href="#cb76-500" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Blue = Overprediction, Red = Underprediction"</span></span>
<span id="cb76-501"><a href="#cb76-501" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb76-502"><a href="#cb76-502" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb76-503"><a href="#cb76-503" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb76-504"><a href="#cb76-504" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb76-505"><a href="#cb76-505" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"gray40"</span>)</span>
<span id="cb76-506"><a href="#cb76-506" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb76-507"><a href="#cb76-507" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb76-508"><a href="#cb76-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-509"><a href="#cb76-509" aria-hidden="true" tabindex="-1"></a>The Negative Binomial model was trained on 2017 sanitation violations and then applied to predict 2018 counts at the 500 m grid level. Model predictions were compared against observed 2018 violations and against a kernel density estimation (KDE) baseline.</span>
<span id="cb76-510"><a href="#cb76-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-511"><a href="#cb76-511" aria-hidden="true" tabindex="-1"></a>Predictive accuracy (temporal validation): The model achieved MAE = 5.05 and RMSE = 7.84, substantially lower than the KDE baseline (MAE = 8.67, RMSE = 12.55). This indicates the regression model generalizes well across time and captures spatial drivers of violation occurrence that simple hotspot persistence (KDE) cannot.</span>
<span id="cb76-512"><a href="#cb76-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-513"><a href="#cb76-513" aria-hidden="true" tabindex="-1"></a>Spatial pattern of errors (map): The map of 2018 prediction errors shows:</span>
<span id="cb76-514"><a href="#cb76-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-515"><a href="#cb76-515" aria-hidden="true" tabindex="-1"></a>Blue cells (over-prediction): areas where the model predicted more violations than actually occurred—often along the southern and western edges of Chicago.</span>
<span id="cb76-516"><a href="#cb76-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-517"><a href="#cb76-517" aria-hidden="true" tabindex="-1"></a>Red cells (under-prediction): locations where observed violations exceeded predictions, mainly clustered in older central neighborhoods. This spatial structure suggests that some unmodeled factors—such as local inspection policies or demographic changes—still influence violation frequency.</span>
<span id="cb76-518"><a href="#cb76-518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-519"><a href="#cb76-519" aria-hidden="true" tabindex="-1"></a>Overall assessment: The Negative Binomial model improves predictive performance over both Poisson and KDE approaches. It handles overdispersion and learns spatial correlates of sanitation activity, making it more robust for forecasting future 311 requests.</span>
<span id="cb76-520"><a href="#cb76-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-521"><a href="#cb76-521" aria-hidden="true" tabindex="-1"></a><span class="fu">#### CHALLENGE TASK: Temporal Validation (2018)</span></span>
<span id="cb76-522"><a href="#cb76-522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-525"><a href="#cb76-525" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb76-526"><a href="#cb76-526" aria-hidden="true" tabindex="-1"></a>crime_2018 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://data.cityofchicago.org/resource/3i3m-jwuy.csv"</span>)</span>
<span id="cb76-527"><a href="#cb76-527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-528"><a href="#cb76-528" aria-hidden="true" tabindex="-1"></a>crime_2018_burg <span class="ot">&lt;-</span> crime_2018 <span class="sc">%&gt;%</span></span>
<span id="cb76-529"><a href="#cb76-529" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(primary_type <span class="sc">==</span> <span class="st">"BURGLARY"</span>,</span>
<span id="cb76-530"><a href="#cb76-530" aria-hidden="true" tabindex="-1"></a>         description <span class="sc">==</span> <span class="st">"FORCIBLE ENTRY"</span>,</span>
<span id="cb76-531"><a href="#cb76-531" aria-hidden="true" tabindex="-1"></a>         <span class="sc">!</span><span class="fu">is.na</span>(longitude), <span class="sc">!</span><span class="fu">is.na</span>(latitude)) <span class="sc">%&gt;%</span></span>
<span id="cb76-532"><a href="#cb76-532" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">year</span>(<span class="fu">as_date</span>(date)))</span>
<span id="cb76-533"><a href="#cb76-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-534"><a href="#cb76-534" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"2018 burglary (FORCIBLE ENTRY) incidents:"</span>, </span>
<span id="cb76-535"><a href="#cb76-535" aria-hidden="true" tabindex="-1"></a>    <span class="fu">nrow</span>(crime_2018_burg), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb76-536"><a href="#cb76-536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-537"><a href="#cb76-537" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb76-538"><a href="#cb76-538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-541"><a href="#cb76-541" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb76-542"><a href="#cb76-542" aria-hidden="true" tabindex="-1"></a>crime_2018_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(</span>
<span id="cb76-543"><a href="#cb76-543" aria-hidden="true" tabindex="-1"></a>  crime_2018_burg,</span>
<span id="cb76-544"><a href="#cb76-544" aria-hidden="true" tabindex="-1"></a>  <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"longitude"</span>, <span class="st">"latitude"</span>),</span>
<span id="cb76-545"><a href="#cb76-545" aria-hidden="true" tabindex="-1"></a>  <span class="at">crs =</span> <span class="dv">4326</span></span>
<span id="cb76-546"><a href="#cb76-546" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb76-547"><a href="#cb76-547" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="fu">st_crs</span>(fishnet))</span>
<span id="cb76-548"><a href="#cb76-548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-549"><a href="#cb76-549" aria-hidden="true" tabindex="-1"></a>counts_crime_2018 <span class="ot">&lt;-</span> <span class="fu">st_join</span>(fishnet, crime_2018_sf, <span class="at">join =</span> st_contains) <span class="sc">%&gt;%</span></span>
<span id="cb76-550"><a href="#cb76-550" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb76-551"><a href="#cb76-551" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(uniqueID, <span class="at">name =</span> <span class="st">"countCrime2018"</span>)</span>
<span id="cb76-552"><a href="#cb76-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-553"><a href="#cb76-553" aria-hidden="true" tabindex="-1"></a>fishnet_crime_2018 <span class="ot">&lt;-</span> fishnet <span class="sc">%&gt;%</span></span>
<span id="cb76-554"><a href="#cb76-554" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(counts_crime_2018, <span class="at">by =</span> <span class="st">"uniqueID"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb76-555"><a href="#cb76-555" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">countCrime2018 =</span> <span class="fu">replace_na</span>(countCrime2018, <span class="dv">0</span>))</span>
<span id="cb76-556"><a href="#cb76-556" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb76-557"><a href="#cb76-557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-560"><a href="#cb76-560" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb76-561"><a href="#cb76-561" aria-hidden="true" tabindex="-1"></a>fishnet_crime_2018<span class="sc">$</span>predCrime <span class="ot">&lt;-</span> <span class="fu">predict</span>(</span>
<span id="cb76-562"><a href="#cb76-562" aria-hidden="true" tabindex="-1"></a>  model_nb,</span>
<span id="cb76-563"><a href="#cb76-563" aria-hidden="true" tabindex="-1"></a>  <span class="at">newdata =</span> fishnet_crime_2018 <span class="sc">%&gt;%</span> <span class="fu">st_drop_geometry</span>(),</span>
<span id="cb76-564"><a href="#cb76-564" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"response"</span></span>
<span id="cb76-565"><a href="#cb76-565" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb76-566"><a href="#cb76-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-567"><a href="#cb76-567" aria-hidden="true" tabindex="-1"></a>fishnet_crime_2018 <span class="ot">&lt;-</span> fishnet_crime_2018 <span class="sc">%&gt;%</span></span>
<span id="cb76-568"><a href="#cb76-568" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">error =</span> countCrime2018 <span class="sc">-</span> predCrime)</span>
<span id="cb76-569"><a href="#cb76-569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-570"><a href="#cb76-570" aria-hidden="true" tabindex="-1"></a>mae_crime <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">abs</span>(fishnet_crime_2018<span class="sc">$</span>error))</span>
<span id="cb76-571"><a href="#cb76-571" aria-hidden="true" tabindex="-1"></a>rmse_crime <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((fishnet_crime_2018<span class="sc">$</span>error)<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb76-572"><a href="#cb76-572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-573"><a href="#cb76-573" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"2018 Burglary Temporal Validation → MAE:"</span>, <span class="fu">round</span>(mae_crime, <span class="dv">2</span>),</span>
<span id="cb76-574"><a href="#cb76-574" aria-hidden="true" tabindex="-1"></a>    <span class="st">" RMSE:"</span>, <span class="fu">round</span>(rmse_crime, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb76-575"><a href="#cb76-575" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb76-576"><a href="#cb76-576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-579"><a href="#cb76-579" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb76-580"><a href="#cb76-580" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb76-581"><a href="#cb76-581" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> chicagoBoundary, <span class="at">fill =</span> <span class="st">"gray95"</span>, <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb76-582"><a href="#cb76-582" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> fishnet_crime_2018, <span class="fu">aes</span>(<span class="at">fill =</span> error), <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb76-583"><a href="#cb76-583" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient2</span>(<span class="at">low =</span> <span class="st">"#2c7bb6"</span>, <span class="at">mid =</span> <span class="st">"white"</span>, <span class="at">high =</span> <span class="st">"#d7191c"</span>,</span>
<span id="cb76-584"><a href="#cb76-584" aria-hidden="true" tabindex="-1"></a>                       <span class="at">midpoint =</span> <span class="dv">0</span>, <span class="at">name =</span> <span class="st">"Error (Obs - Pred)"</span>) <span class="sc">+</span></span>
<span id="cb76-585"><a href="#cb76-585" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"2018 Burglary (FORCIBLE ENTRY) Prediction Errors"</span>,</span>
<span id="cb76-586"><a href="#cb76-586" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Predicted using 2017 Sanitation Model"</span>,</span>
<span id="cb76-587"><a href="#cb76-587" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">"Blue = Overprediction, Red = Underprediction"</span>) <span class="sc">+</span></span>
<span id="cb76-588"><a href="#cb76-588" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb76-589"><a href="#cb76-589" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb76-590"><a href="#cb76-590" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb76-591"><a href="#cb76-591" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"gray40"</span>)</span>
<span id="cb76-592"><a href="#cb76-592" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb76-593"><a href="#cb76-593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-594"><a href="#cb76-594" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb76-595"><a href="#cb76-595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-596"><a href="#cb76-596" aria-hidden="true" tabindex="-1"></a>The 2018 burglary prediction errors show systematic overprediction (predicted counts higher than observed), indicating limited transferability of the sanitation-based model to crime patterns. Moreover, the Poisson model was found to be overdispersed (variance ≫ mean), justifying the use of a Negative Binomial specification, which effectively reweights the variance structure to better model spatially heterogeneous count data.</span>
<span id="cb76-597"><a href="#cb76-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-598"><a href="#cb76-598" aria-hidden="true" tabindex="-1"></a><span class="fu">## Step 3: Analysis</span></span>
<span id="cb76-599"><a href="#cb76-599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-600"><a href="#cb76-600" aria-hidden="true" tabindex="-1"></a><span class="fu">### Overview</span></span>
<span id="cb76-601"><a href="#cb76-601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-602"><a href="#cb76-602" aria-hidden="true" tabindex="-1"></a>This project builds a spatial predictive model of sanitation-related 311 service requests in Chicago for 2017–2018. Using a 500 m × 500 m fishnet grid as the spatial unit, the analysis combines descriptive mapping, spatial autocorrelation diagnostics, and count regression models to understand and predict the geographic distribution of sanitation code violations.</span>
<span id="cb76-603"><a href="#cb76-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-604"><a href="#cb76-604" aria-hidden="true" tabindex="-1"></a>Spatial clustering and model diagnostics show that these urban service complaints are not randomly distributed. Instead, they exhibit strong spatial dependence—particularly along the South and West Sides—reflecting the persistence of neighborhood-level environmental and socioeconomic inequalities.</span>
<span id="cb76-605"><a href="#cb76-605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-606"><a href="#cb76-606" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb76-607"><a href="#cb76-607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-608"><a href="#cb76-608" aria-hidden="true" tabindex="-1"></a><span class="fu">### 1. Spatial Clustering</span></span>
<span id="cb76-609"><a href="#cb76-609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-610"><a href="#cb76-610" aria-hidden="true" tabindex="-1"></a>Exploratory mapping revealed clear spatial concentrations of sanitation violations. Local Moran’s I confirmed statistically significant **High-High clusters** (hotspots) in central-west and south-side neighborhoods, while **Low-Low clusters** occurred in more peripheral or affluent areas.\</span>
<span id="cb76-611"><a href="#cb76-611" aria-hidden="true" tabindex="-1"></a>This indicates that sanitation complaints follow patterns of older housing stock, population turnover, and varying municipal service responsiveness.</span>
<span id="cb76-612"><a href="#cb76-612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-613"><a href="#cb76-613" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb76-614"><a href="#cb76-614" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-615"><a href="#cb76-615" aria-hidden="true" tabindex="-1"></a><span class="fu">### 2. Count Regression Modeling</span></span>
<span id="cb76-616"><a href="#cb76-616" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-617"><a href="#cb76-617" aria-hidden="true" tabindex="-1"></a>Both Poisson and Negative Binomial (NB) count models were fit to predict the number of violations per grid cell using two spatial covariates:</span>
<span id="cb76-618"><a href="#cb76-618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-619"><a href="#cb76-619" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Mean distance to nearest 3 sanitation events (nn_meanDist)**</span>
<span id="cb76-620"><a href="#cb76-620" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Distance to the nearest high-high cluster centroid (dist_to_hotspot)**</span>
<span id="cb76-621"><a href="#cb76-621" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-622"><a href="#cb76-622" aria-hidden="true" tabindex="-1"></a>The Poisson model exhibited **overdispersion** (dispersion = 4.54 ≫ 1.5), meaning that the variance of counts greatly exceeded the mean.\</span>
<span id="cb76-623"><a href="#cb76-623" aria-hidden="true" tabindex="-1"></a>The NB model corrected this issue and achieved a much better fit (AIC = 11 212 vs 14 422 for Poisson), validating the choice of a variance-adjusted count specification.\</span>
<span id="cb76-624"><a href="#cb76-624" aria-hidden="true" tabindex="-1"></a>Both predictors were significantly negative, showing that proximity to existing violations and hotspots strongly increases expected complaint frequency.</span>
<span id="cb76-625"><a href="#cb76-625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-626"><a href="#cb76-626" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb76-627"><a href="#cb76-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-628"><a href="#cb76-628" aria-hidden="true" tabindex="-1"></a><span class="fu">### 3. Spatial Cross-Validation (2017)</span></span>
<span id="cb76-629"><a href="#cb76-629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-630"><a href="#cb76-630" aria-hidden="true" tabindex="-1"></a>A **Leave-One-District-Out (LOGO)** cross-validation using Chicago’s 22 police districts assessed spatial generalizability.\</span>
<span id="cb76-631"><a href="#cb76-631" aria-hidden="true" tabindex="-1"></a>The model achieved **Mean MAE = 4.67** and **Mean RMSE = 7.74**, confirming moderate predictive power in unseen areas.\</span>
<span id="cb76-632"><a href="#cb76-632" aria-hidden="true" tabindex="-1"></a>Prediction errors were larger in dense downtown and inner-south districts, highlighting the spatial heterogeneity of urban sanitation behavior.</span>
<span id="cb76-633"><a href="#cb76-633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-634"><a href="#cb76-634" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb76-635"><a href="#cb76-635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-636"><a href="#cb76-636" aria-hidden="true" tabindex="-1"></a><span class="fu">### 4. Temporal Validation (2018)</span></span>
<span id="cb76-637"><a href="#cb76-637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-638"><a href="#cb76-638" aria-hidden="true" tabindex="-1"></a>Applying the 2017 NB model to 2018 sanitation data yielded **MAE = 5.05** and **RMSE = 7.84**, outperforming a non-parametric **KDE baseline** (MAE = 8.67, RMSE = 12.55).\</span>
<span id="cb76-639"><a href="#cb76-639" aria-hidden="true" tabindex="-1"></a>The model successfully generalized across years, indicating that neighborhood-level structural factors—rather than year-specific policy noise—drive much of the spatial pattern in 311 sanitation requests.</span>
<span id="cb76-640"><a href="#cb76-640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-641"><a href="#cb76-641" aria-hidden="true" tabindex="-1"></a>The 2018 error map showed: - **Blue areas (overprediction)** around southern and western peripheries\</span>
<span id="cb76-642"><a href="#cb76-642" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Red areas (underprediction)** concentrated in inner neighborhoods where new complaints emerged in 2018</span>
<span id="cb76-643"><a href="#cb76-643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-644"><a href="#cb76-644" aria-hidden="true" tabindex="-1"></a>These differences likely stem from unmodeled local dynamics such as inspection intensity, redevelopment, or seasonal population change.</span>
<span id="cb76-645"><a href="#cb76-645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-646"><a href="#cb76-646" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb76-647"><a href="#cb76-647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-648"><a href="#cb76-648" aria-hidden="true" tabindex="-1"></a><span class="fu">### 5. Challenge Task: Cross-Domain Validation (2018 Burglary)</span></span>
<span id="cb76-649"><a href="#cb76-649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-650"><a href="#cb76-650" aria-hidden="true" tabindex="-1"></a>The 2017 sanitation model was tested on **2018 burglary (forcible entry)** events to evaluate cross-domain transferability.\</span>
<span id="cb76-651"><a href="#cb76-651" aria-hidden="true" tabindex="-1"></a>Results showed systematic **overprediction** across most grid cells, meaning that the model assumed crime would occur with similar spatial intensity as sanitation violations.\</span>
<span id="cb76-652"><a href="#cb76-652" aria-hidden="true" tabindex="-1"></a>This demonstrates that while spatial autocorrelation structures are similar across urban phenomena, the underlying generative mechanisms (social, behavioral, or policing factors) differ substantially.</span>
<span id="cb76-653"><a href="#cb76-653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-654"><a href="#cb76-654" aria-hidden="true" tabindex="-1"></a>Such overprediction underscores the **domain specificity** of spatial count processes and the importance of incorporating domain-relevant variables when extending predictive models to new phenomena.</span>
<span id="cb76-655"><a href="#cb76-655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-656"><a href="#cb76-656" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb76-657"><a href="#cb76-657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-658"><a href="#cb76-658" aria-hidden="true" tabindex="-1"></a><span class="fu">### 6. Interpretation</span></span>
<span id="cb76-659"><a href="#cb76-659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-660"><a href="#cb76-660" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>**Spatial dependence matters:** Incorporating local spatial features (e.g., nearest-neighbor distances) substantially improves prediction over simple density persistence models.\</span>
<span id="cb76-661"><a href="#cb76-661" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>**Overdispersion is the rule, not the exception:** Urban event counts rarely meet Poisson variance assumptions; the Negative Binomial model offers a practical correction by weighting variance heterogeneity.\</span>
<span id="cb76-662"><a href="#cb76-662" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>**Temporal generalization is feasible:** Structural neighborhood effects remain stable across years.\</span>
<span id="cb76-663"><a href="#cb76-663" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>**Cross-domain generalization is limited:** Models trained on sanitation data poorly capture crime patterns, revealing that social drivers differ even when spatial clustering appears similar.</span>
<span id="cb76-664"><a href="#cb76-664" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-665"><a href="#cb76-665" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb76-666"><a href="#cb76-666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-667"><a href="#cb76-667" aria-hidden="true" tabindex="-1"></a>Spatially explicit predictive modeling of 311 sanitation complaints can help city agencies prioritize inspection and maintenance resources more efficiently.\</span>
<span id="cb76-668"><a href="#cb76-668" aria-hidden="true" tabindex="-1"></a>However, models must remain adaptive—incorporating updated data, temporal shifts, and behavioral heterogeneity—to avoid reinforcing historical inequalities in service delivery.\</span>
<span id="cb76-669"><a href="#cb76-669" aria-hidden="true" tabindex="-1"></a>For broader urban analytics, this exercise shows both the potential and the limits of spatial transfer learning in complex social environments.</span>
</code></pre></div><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>